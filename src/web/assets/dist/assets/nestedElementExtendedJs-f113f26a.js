(function(T){const{Craft:h,Garnish:l,$:e}=T;!h||!l||!e||(h.NestedElementExtended=l.Base.extend({settings:{},childParent:{},helper:void 0,init:function(i,o){const $=this;if(this.settings=i.settings||{},this.childParent=i.childParent||{},this.helper=o,!l.DisclosureMenu||!h.NestedElementManager)return;const d=l.DisclosureMenu.prototype.init;l.DisclosureMenu.prototype.init=function(...s){d.apply(this,s),$.initAddButtonMenu(this)}},initAddButtonMenu(i){if(!this.settings.expandMenu)return;const{$trigger:o,$container:$}=i,d=o.parent(),s=o.closest(".nested-element-cards"),r=s.data("nestedElementManager");if(!r||!o||!$||d.hasClass("card-actions")||!s.attr("id")||!Array.isArray(r.settings.createAttributes)||o._hasNestedElementExtensionButtonsInitialized)return;o.hide(),o._hasNestedElementExtensionButtonsInitialized=!0;const n=e('<div class="buttons matrix-extended-buttons"></div>'),c=h.ui.createButton({label:r.settings.createButtonLabel,spinner:!0}).addClass("add icon disabled"),g=e("<div/>").appendTo($);c.addClass("dashed").appendTo(g);const b=`menu-${Math.floor(Math.random()*1e6)}`,M=e("<div/>",{id:b,class:"menu menu--disclosure"}).insertAfter(c),y=e("<ul/>").appendTo(M);for(const a of r.settings.createAttributes){const m=e("<li/>").appendTo(y);let f="";if(a.icon){const u=e(`<span class="icon">${a.icon}</span>`);a.color&&u.addClass(a.color),f+=u.prop("outerHTML")}f+=`<span class="label">${a.label}</span>`;const x=e("<button/>",{type:"button",class:"menu-item","data-type":this.helper.getEntryTypeById(a.attributes.typeId).name,html:f}).appendTo(m);this.addListener(x,"activate",u=>{u.preventDefault(),c.data("disclosureMenu").hide(),r.createElement(a.attributes)})}c.attr("aria-controls",b).attr("data-disclosure-trigger","true").addClass("menubtn").disclosureMenu();const t=c.disclosureMenu().data("disclosureMenu").$container.find("button").clone().off().on("activate",async a=>{const m=e(a.currentTarget);c.disclosureMenu().data("disclosureMenu").$container.find("button").filter((x,u)=>e(u).data("type")===m.data("type")).trigger("activate")}),p=s.attr("id");this.buildGroupedMenu(n,t,o,p),n.appendTo(d)},buildGroupedMenu:function(i,o,$,d,s=!1){let r=d.replace(/.*fields-/,"");r=r.replace(/-element-index-.*/,"");let n=o;if(!this.settings.fields){const t=e('<div class="btngroup matrix-extended-btngroup"></div>');n.first().addClass("add icon"),n.addClass("btn dashed"),t.append(n),i.append(t);return}if(!this.settings.fields[r]){const t=e('<div class="btngroup matrix-extended-btngroup"></div>');n.first().addClass("add icon"),n.addClass("btn dashed"),t.append(n),i.append(t);return}const c=this.settings.fields[r];c.oneLiner&&i.addClass("one-line");for(const[t,p]of Object.entries(c.groups)){e(`#matrix-extended-menu-${d}-${t}${s?"-above":""}`).remove();const a=h.ui.createButton({label:p.label,spinner:!0}).addClass("btn menubtn dashed add icon").attr("aria-controls",`matrix-extended-menu-${d}-${t}${s?"-above":""}`).appendTo(i),m=e(`<div class="menu menu--disclosure" id="matrix-extended-menu-${d}-${t}${s?"-above":""}">`),f=e("<ul></ul>");m.append(f),e(document.body).append(m);const x=new l.DisclosureMenu(a);for(const u of p.types){const C=e("<li></li>"),v=o.filter((E,B)=>e(B).data("type")===u);if(n=n.filter((E,B)=>e(B).data("type")!==u),!v.length){console.warn(`Type ${u} not found in group ${d}`);continue}C.append(v),f.append(C),v.on("activate",()=>{if(!s){x.hide();return}m.remove(),x.destroy()})}}if(!n.length)return;if(this.settings.expandUngrouped){const t=e('<div class="btngroup matrix-extended-btngroup"></div>');switch(n.first().addClass("add icon"),n.addClass("btn dashed"),t.append(n),this.settings.ungroupedPosition){case"start":i.prepend(t);break;case"end":i.append(t);break}return}e(`#matrix-extended-menu-${d}-others${s?"-above":""}`).remove();const g=h.ui.createButton({label:$.find(".label").text(),spinner:!0}).addClass("btn menubtn dashed add icon").attr("aria-controls",`matrix-extended-menu-${d}-others${s?"-above":""}`);switch(this.settings.ungroupedPosition){case"start":g.prependTo(i);break;case"end":g.appendTo(i);break}const b=e(`<div class="menu menu--disclosure" id="matrix-extended-menu-${d}-others${s?"-above":""}">`),M=e("<ul></ul>");b.append(M),e(document.body).append(b);const y=new l.DisclosureMenu(g);for(const t of n){const p=e("<li></li>"),a=e(t);p.append(a),M.append(p),a.on("activate",()=>{if(!s){y.hide();return}b.remove(),y.destroy()})}}}))})(window);
//# sourceMappingURL=nestedElementExtendedJs-f113f26a.js.map

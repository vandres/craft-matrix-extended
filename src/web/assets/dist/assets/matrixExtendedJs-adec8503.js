(function(B){const{Craft:r,Garnish:f,$:a}=B;!r||!f||!a||(r.MatrixExtended=f.Base.extend({settings:{},childParent:{},helper:void 0,itemDrag:void 0,init:function(s,i){const n=this;if(this.settings=s.settings||{},this.childParent=s.childParent||{},this.helper=i,!f.DisclosureMenu||!r.MatrixInput)return;const t=f.DisclosureMenu.prototype.show;f.DisclosureMenu.prototype.show=function(...o){n.initDisclosureMenu(this),t.apply(this,o)};const e=f.DisclosureMenu.prototype.init;f.DisclosureMenu.prototype.init=function(...o){e.apply(this,o),n.initAddButtonMenu(this),n.prepareEntryDropZones()};const c=r.MatrixInput.prototype.updateAddEntryBtn;if(r.MatrixInput.prototype.updateAddEntryBtn=function(...o){c.apply(this,o),n.checkAddBtn(this)},!this.settings.experimentalFeatures||!this.settings.enableDragDrop)return;const d=r.MatrixInput.prototype.init;r.MatrixInput.prototype.init=function(...o){d.apply(this,o),this.entrySort.allowDragging=()=>!1,this.entrySort.destroy(),n.prepareEntryDropZones()},r.MatrixInput.prototype.canAddMoreEntries=function(){return!this.maxEntries||this.$entriesContainer.children(":not(.matrix-extended-drop-target):not(.matrix-extended-buttons)").length<this.maxEntries},this.itemDrag=new f.DragDrop({activeDropTargetClass:"active",minMouseDist:10,hideDraggee:!1,moveHelperToCursor:!0,handle:o=>a(o).find("> .actions > .move, > .titlebar"),filter:()=>this.itemDrag.$targetItem.closest(".matrixblock"),dropTargets:()=>{if(!this.childParent)return[];const{entry:o,typeId:l}=this.itemDrag.$draggee.closest(".matrixblock").data();return!o.matrix||!l?[]:a(".matrix-extended-drop-target").filter((m,p)=>(this.childParent[l]||[]).includes(a(p).data("entryTypeId"))).toArray().reverse()},onDragStart:()=>{f.$bod.addClass("dragging"),this.itemDrag.$draggee.closest(".matrixblock").addClass("draggee"),this.$dropEntry=this.itemDrag.$draggee.data("entry").$container,this.$pullBlock=this.$dropEntry.closest(".matrix-field")},onDragStop:async()=>{if(this.itemDrag.$draggee.closest(".matrixblock").removeClass("draggee"),f.$bod.removeClass("dragging"),!this.$dropEntry||!this.$pullBlock)return this.itemDrag.returnHelpersToDraggees();const o=this.$dropEntry,l=this.itemDrag.$activeDropTarget;if(!o||!l)return this.itemDrag.returnHelpersToDraggees();let u,h="insertBefore";l.data("position")==="button"?(u=l.closest(".matrix-field").find("> .blocks"),h="appendTo"):u=l.next(".matrixblock");const m=this.$pullBlock,p=l.closest(".matrix-field");if(m.is(p))h==="appendTo"?o.appendTo(u):o.insertBefore(u),m.data("matrix").entrySelect.resetItemOrder();else{const g=p.data("matrix"),y=m.data("matrix"),b=o.data("entry"),$=o.data("typeId");await this.duplicateWithNewOwner(u,h,$,b,g,y)}this.itemDrag.returnHelpersToDraggees(),this.prepareEntryDropZones(),this.$dropEntry=void 0,this.$pullBlock=void 0}})},prepareEntryDropZones(){if(!this.settings.experimentalFeatures||!this.settings.enableDragDrop)return;const s=a(".matrix-field"),i=s.find(".matrixblock");a(".matrix-extended-drop-target").remove();for(const t of i){const e=a(t);let c=null;const d=e.data("entry");if(!d)return;const o=d.matrix;if(!o)return;c=o.settings.fieldId;const l=a('<div class="matrix-extended-drop-target" data-position="block"><div></div></div>');l.data(e.data()),l.data("entryTypeId",c),e.before(l)}const n=s.find("> .buttons");for(const t of n){const e=a(t),c=e.closest(".matrix-field").data("matrix");if(!c)continue;const d=a('<div class="matrix-extended-drop-target" data-position="button"><div></div></div>');d.data("entryTypeId",c.settings.fieldId),d.insertBefore(e)}this.itemDrag.removeAllItems(),this.itemDrag.addItems(i),f.$bod.addClass("matrix-extended-drag-drop")},initAddButtonMenu(s){if(!this.settings.expandMenu)return;const{$trigger:i,$container:n}=s,t=i.parent(),e=i.closest(".buttons").parent(".matrix-field");if(!i||!n||!t.hasClass("buttons")||!e.attr("id")||i._hasMatrixExtensionButtonsInitialized)return;i.hide(),i._hasMatrixExtensionButtonsInitialized=!0;const c=a('<div class="buttons matrix-extended-buttons"></div>'),d=i.disclosureMenu().data("disclosureMenu").$container.find("button").clone().off().on("activate",async l=>{n.find("button").filter((h,m)=>a(m).data("type")===a(l.currentTarget).data("type")).trigger("activate")}),o=e.attr("id");this.buildGroupedMenu(c,d,i,o),c.appendTo(t)},initDisclosureMenu(s){const{$trigger:i,$container:n}=s;if(!i||!n||!i.hasClass("action-btn"))return;const t=i.closest(".actions").parent(".matrixblock");if(!t.length)return;const{typeId:e,entry:c}=t.data();if(!e||!c)return;const d=c.matrix;if(d){if(s._hasMatrixExtensionButtonsInitialized){this.checkPaste(n,d),this.checkDuplicate(n,d),this.checkAdd(n,d);return}s._hasMatrixExtensionButtonsInitialized=!0,this.addMenu(n,e,c,d)}},pasteEntry:async function(s,i,n,t){var e;if(!t.addingEntry){if(!t.canAddMoreEntries()){t.updateStatusMessage();return}t.addingEntry=!0,t.elementEditor&&await t.elementEditor.setFormValue(t.settings.baseInputName,"*");try{const c=t.elementEditor.getDraftElementId(n.id),{data:d}=await r.sendActionRequest("POST","matrix-extended/matrix-extended/paste-entry",{data:{fieldId:t.settings.fieldId,entryId:c,entryTypeId:i,ownerId:t.settings.ownerId,ownerElementType:t.settings.ownerElementType,siteId:t.settings.siteId,namespace:t.settings.namespace,staticEntries:t.settings.staticEntries}}),o=a(d.blockHtml);(e=t.elementEditor)==null||e.pause(),o.insertAfter(n.$container),t.trigger("entryAdded",{$entry:o}),o.css("margin-bottom",""),r.initUiElements(o.children(".fields")),await r.appendHeadHtml(d.headHtml),await r.appendBodyHtml(d.bodyHtml),new r.MatrixInput.Entry(t,o),t.entrySort.addItems(o),t.entrySelect.addItems(o),t.updateAddEntryBtn(),o.css(t.getHiddenEntryCss(o)).velocity({opacity:1,"margin-bottom":10},"fast"),f.requestAnimationFrame(function(){var l;(l=t.elementEditor)==null||l.resume()})}catch{this.addStatusMessage(r.t("matrix-extended","There was an error pasting the entry"),"error")}t.addingEntry=!1,n.actionDisclosure.hide()}},duplicateWithNewOwner:async function(s,i,n,t,e,c){var d;if(!e.addingEntry){if(!e.canAddMoreEntries()){e.updateStatusMessage();return}e.addingEntry=!0,e.elementEditor&&await e.elementEditor.setFormValue(e.settings.baseInputName,"*");try{const o=e.elementEditor.getDraftElementId(t.id),{data:l}=await r.sendActionRequest("POST","matrix-extended/matrix-extended/duplicate-entry-with-new-owner",{data:{fieldId:e.settings.fieldId,entryId:o,entryTypeId:n,ownerId:e.settings.ownerId,ownerElementType:e.settings.ownerElementType,siteId:e.settings.siteId,namespace:e.settings.namespace,staticEntries:e.settings.staticEntries}}),u=a(l.blockHtml);(d=e.elementEditor)==null||d.pause(),i==="appendTo"?u.appendTo(s):u.insertBefore(s),t.$container.hide(),e.trigger("entryAdded",{$entry:u}),u.css("margin-bottom",""),r.initUiElements(u.children(".fields")),await r.appendHeadHtml(l.headHtml),await r.appendBodyHtml(l.bodyHtml),new r.MatrixInput.Entry(e,u),e.entrySort.addItems(u),e.entrySelect.addItems(u),e.updateAddEntryBtn(),u.css(e.getHiddenEntryCss(u)).velocity({opacity:1,"margin-bottom":10},"fast"),f.requestAnimationFrame(function(){var h;(h=e.elementEditor)==null||h.resume(),t.selfDestruct()})}catch{this.addStatusMessage(r.t("matrix-extended","There was an error dropping the entry"),"error")}e.addingEntry=!1,t.actionDisclosure.hide()}},copyEntry:async function(s,i,n,t){try{const e=t.elementEditor.getDraftElementId(n.id),{data:c}=await r.sendActionRequest("POST","matrix-extended/matrix-extended/copy-entry",{data:{fieldId:t.settings.fieldId,entryId:e,entryTypeId:i,ownerId:t.settings.ownerId,ownerElementType:t.settings.ownerElementType,siteId:t.settings.siteId,namespace:t.settings.namespace,staticEntries:t.settings.staticEntries}});this.helper.setEntryReference(c.entryReference),this.checkPaste(s,t),this.checkDuplicate(s,t),this.checkAdd(s,t),await r.appendHeadHtml(c.headHtml),await r.appendBodyHtml(c.bodyHtml),this.addStatusMessage(r.t("matrix-extended","Entry reference copied"))}catch{this.addStatusMessage(r.t("matrix-extended","There was an error copying the entry reference"),"error")}n.actionDisclosure.hide()},duplicateEntry:async function(s,i,n,t){var c;if(t.addingEntry)return;if(!t.canAddMoreEntries()){t.updateStatusMessage();return}t.addingEntry=!0,t.elementEditor&&await t.elementEditor.setFormValue(t.settings.baseInputName,"*");const e=t.elementEditor.getDraftElementId(n.id);try{const{data:d}=await r.sendActionRequest("POST","matrix-extended/matrix-extended/duplicate-entry",{data:{fieldId:t.settings.fieldId,entryId:e,entryTypeId:i,ownerId:t.settings.ownerId,ownerElementType:t.settings.ownerElementType,siteId:t.settings.siteId,namespace:t.settings.namespace,staticEntries:t.settings.staticEntries}}),o=a(d.blockHtml);(c=t.elementEditor)==null||c.pause(),o.insertAfter(n.$container),t.trigger("entryAdded",{$entry:o}),o.css("margin-bottom",""),r.initUiElements(o.children(".fields")),await r.appendHeadHtml(d.headHtml),await r.appendBodyHtml(d.bodyHtml),new r.MatrixInput.Entry(t,o),t.entrySort.addItems(o),t.entrySelect.addItems(o),t.updateAddEntryBtn(),o.css(t.getHiddenEntryCss(o)).velocity({opacity:1,"margin-bottom":10},"fast"),f.requestAnimationFrame(function(){var l;(l=t.elementEditor)==null||l.resume()})}catch{this.addStatusMessage(r.t("matrix-extended","There was an error duplicating the entry"),"error")}t.addingEntry=!1,n.actionDisclosure.hide()},addMenu:function(s,i,n,t){const e=a('<ul class="matrix-extended"></ul>'),c=a('<hr class="padded">');if(this.addAddBlockButton(e,i,n,t),this.addDuplicateButton(e,i,n,t),this.addCopyButton(e,i,n,t),this.addPasteButton(e,i,n,t),this.addDeleteButton(e,n),this.checkPaste(e,t),this.checkDuplicate(e,t),this.checkAdd(e,t),e.insertBefore(s.find("ul").eq(0)),c.insertAfter(e),this.settings.removeEntryTypesFromDiscloseMenu){const d=s.find('[data-action="add"]').parent().parent();d.prev().remove(),d.remove()}},addPasteButton:function(s,i,n,t){if(!this.settings.enableCopyPaste)return;const e=a(`<li>
            <button class="menu-item" data-action="paste" tabindex="0"> 
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M104.6 48H64C28.7 48 0 76.7 0 112V384c0 35.3 28.7 64 64 64h96V400H64c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H80c0 17.7 14.3 32 32 32h72.4C202 108.4 227.6 96 256 96h62c-7.1-27.6-32.2-48-62-48H215.4C211.6 20.9 188.2 0 160 0s-51.6 20.9-55.4 48zM144 56a16 16 0 1 1 32 0 16 16 0 1 1 -32 0zM448 464H256c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16l140.1 0L464 243.9V448c0 8.8-7.2 16-16 16zM256 512H448c35.3 0 64-28.7 64-64V243.9c0-12.7-5.1-24.9-14.1-33.9l-67.9-67.9c-9-9-21.2-14.1-33.9-14.1H256c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64z"/></svg>
                        </span><span class="menu-item-label">${r.t("matrix-extended","Paste")}</span>
                    </button>
                </li>`);s.append(e),e.find("button").on("click",()=>{this.pasteEntry(s,i,n,t)})},addAddBlockButton:function(s,i,n,t){if(!this.settings.enableAddBlockAbove||!t.$addEntryMenuBtn.length&&!t.$addEntryBtn.length)return;const e=a(`<li>
                    <button class="menu-item" data-action="add-block" tabindex="0">
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M64 80c-8.8 0-16 7.2-16 16V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V96c0-8.8-7.2-16-16-16H64zM0 96C0 60.7 28.7 32 64 32H384c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM200 344V280H136c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H248v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/></svg>
                        </span><span class="menu-item-label">${r.t("matrix-extended","Add block above")}</span>
                    </button>
                </li>`);s.append(e),e.find("button").on("click",()=>{const c=t.id;a(".matrix-extended-buttons-above").remove(),a(`#matrix-extended-menu-${c}-all`).remove();const d=a('<div class="buttons matrix-extended-buttons matrix-extended-buttons-above"></div>'),o=t.$addEntryMenuBtn.length?t.$addEntryMenuBtn.data("disclosureMenu").$container.find("button").clone().off():t.$addEntryBtn.clone().off(),l=r.ui.createButton({label:t.$addEntryMenuBtn.find(".label").text(),spinner:!0}).addClass("btn menubtn dashed add icon").attr("aria-controls",`matrix-extended-menu-${c}-all`),u=a(`<div class="menu menu--disclosure" id="matrix-extended-menu-${c}-all">`),h=a("<ul></ul>");u.append(h),a(document.body).append(u);const m=new f.DisclosureMenu(l);for(const p of o){const g=a("<li></li>"),y=a(p);g.append(y),h.append(g)}if(o.on("activate",async p=>{if(a(p.currentTarget).closest(`#matrix-extended-menu-${c}-all`).length){l.addClass("loading");try{await t.addEntry(a(p.currentTarget).data("type"),n.$container[0].checkVisibility()?n.$container:void 0)}finally{m.hide(),l.remove(),u.remove(),d.remove()}}}),this.settings.expandMenu){const g=l.data("disclosureMenu").$container.find("button").clone(!0,!0);this.buildGroupedMenu(d,g,l,c,!0)}else d.append(l);d.insertBefore(n.$container),n.actionDisclosure.hide()})},addCopyButton:function(s,i,n,t){if(!this.settings.enableCopyPaste)return;const e=a(`<li>
                    <button class="menu-item" data-action="copy" tabindex="0">
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M280 64h40c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128C0 92.7 28.7 64 64 64h40 9.6C121 27.5 153.3 0 192 0s71 27.5 78.4 64H280zM64 112c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16H320c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H304v24c0 13.3-10.7 24-24 24H192 104c-13.3 0-24-10.7-24-24V112H64zm128-8a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"/></svg>
                        </span><span class="menu-item-label">${r.t("matrix-extended","Copy")}</span>
                    </button>
                </li>`);s.append(e),e.find("button").on("click",()=>{this.copyEntry(s,i,n,t)})},addDuplicateButton:function(s,i,n,t){if(!this.settings.enableDuplicate)return;const e=a(`<li>
                <button class="menu-item" data-action="duplicate" tabindex="0">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z"/></svg>
                    </span><span class="menu-item-label">${r.t("matrix-extended","Duplicate")}</span>
                </button>
            </li>`);s.append(e),e.find("button").on("click",()=>{this.duplicateEntry(s,i,n,t)})},addDeleteButton:function(s,i){if(!this.settings.extraDeleteButton)return;const n=a(`<li>
                <button class="menu-item error" data-action="delete" tabindex="0">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>
                    </span><span class="menu-item-label">${r.t("matrix-extended","Delete")}</span>
                </button>
            </li>`);s.append(n),n.find("button").on("click",function(){i.selfDestruct(),i.actionDisclosure.hide()})},buildGroupedMenu:function(s,i,n,t,e=!1){const c=t.replace(/.*fields-/,"");let d=i;if(!this.settings.fields){const p=a('<div class="btngroup matrix-extended-btngroup"></div>');d.first().addClass("add icon"),d.addClass("btn dashed"),p.append(d),s.append(p);return}if(!this.settings.fields[c]){const p=a('<div class="btngroup matrix-extended-btngroup"></div>');d.first().addClass("add icon"),d.addClass("btn dashed"),p.append(d),s.append(p);return}const o=this.settings.fields[c];o.oneLiner&&s.addClass("one-line");for(const[p,g]of Object.entries(o.groups)){a(`#matrix-extended-menu-${t}-${p}${e?"-above":""}`).remove();const y=r.ui.createButton({label:g.label,spinner:!0}).addClass("btn menubtn dashed add icon").attr("aria-controls",`matrix-extended-menu-${t}-${p}${e?"-above":""}`).appendTo(s),b=a(`<div class="menu menu--disclosure" id="matrix-extended-menu-${t}-${p}${e?"-above":""}">`),$=a("<ul></ul>");b.append($),a(document.body).append(b);const v=new f.DisclosureMenu(y);for(const w of g.types){const I=a("<li></li>"),E=i.filter((M,x)=>a(x).data("type")===w);if(d=d.filter((M,x)=>a(x).data("type")!==w),!E.length){console.warn(`Type ${w} not found in group ${t}`);continue}I.append(E),$.append(I),E.on("activate",()=>{if(!e){v.hide();return}b.remove(),v.destroy()})}}if(!d.length)return;if(this.settings.expandUngrouped){const p=a('<div class="btngroup matrix-extended-btngroup"></div>');d.first().addClass("add icon"),d.addClass("btn dashed"),p.append(d),this.settings.ungroupedPosition==="end"?s.append(p):s.prepend(p);return}a(`#matrix-extended-menu-${t}-others${e?"-above":""}`).remove();const l=r.ui.createButton({label:n.find(".label").text(),spinner:!0}).addClass("btn menubtn dashed add icon").attr("aria-controls",`matrix-extended-menu-${t}-others${e?"-above":""}`);this.settings.ungroupedPosition==="end"?l.appendTo(s):l.prependTo(s);const u=a(`<div class="menu menu--disclosure" id="matrix-extended-menu-${t}-others${e?"-above":""}">`),h=a("<ul></ul>");u.append(h),a(document.body).append(u);const m=new f.DisclosureMenu(l);for(const p of d){const g=a("<li></li>"),y=a(p);g.append(y),h.append(g),y.on("activate",()=>{if(!e){m.hide();return}u.remove(),m.destroy()})}},checkAdd:function(s,i){const n=s.find('button[data-action="add-block"]');n.disable();const t=n.parent();if(t.attr("title",""),!i.canAddMoreEntries()){t.attr("title",r.t("matrix-extended","No more entries can be added."));return}n.enable()},checkAddBtn:function(s){if(!this.settings.expandMenu)return;const i=s.$container.find("> .blocks > .matrix-extended-buttons, > .buttons > .matrix-extended-buttons").find("button");i.disable();const n=i.parent();if(n.attr("title",""),!s.canAddMoreEntries()){n.attr("title",r.t("matrix-extended","No more entries can be added."));return}i.enable()},checkDuplicate:function(s,i){const n=s.find('button[data-action="duplicate"]');n.disable();const t=n.parent();if(t.attr("title",""),!i.canAddMoreEntries()){t.attr("title",r.t("matrix-extended","No more entries can be added."));return}n.enable()},checkPaste:function(s,i){const n=s.find('button[data-action="paste"]');n.disable();const t=n.parent();if(t.attr("title",""),!this.helper.getEntryReference()||!this.helper.getEntryReference().entryTypeId){t.attr("title",r.t("matrix-extended","There is nothing to paste."));return}if(!i.canAddMoreEntries()){t.attr("title",r.t("matrix-extended","No more entries can be added."));return}if(!this.helper.isEntryReferenceAllowed(i.settings.fieldId)){t.attr("title",r.t("matrix-extended","The copied entry is not allowed here."));return}n.enable()},addStatusMessage:function(s,i="notice"){i==="notice"&&r.cp.displayNotice(s),i==="error"&&r.cp.displayError(s)}}))})(window);
//# sourceMappingURL=matrixExtendedJs-adec8503.js.map

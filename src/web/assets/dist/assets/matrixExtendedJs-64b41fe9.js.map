{"version":3,"file":"matrixExtendedJs-64b41fe9.js","sources":["../../../../../static/src/js/matrixExtended.ts"],"sourcesContent":["(function (window: any) {\n    const {Craft, Garnish, $} = window;\n    if (!Craft || !Garnish || !$) {\n        return;\n    }\n\n    Craft.MatrixExtended = Garnish.Base.extend({\n        settings: {}, childParent: {}, entryReference: undefined, itemDrag: undefined,\n\n        init: function (config: { settings: any, childParent: any, entryReference: any }) {\n            const self = this;\n            this.settings = config.settings || {};\n            this.childParent = config.childParent || {};\n            this.entryReference = config.entryReference || undefined;\n\n            // Init disclosure menus\n            if (!Garnish.DisclosureMenu) {\n                return;\n            }\n\n            const disclosureMenuShowFn = Garnish.DisclosureMenu.prototype.show;\n            Garnish.DisclosureMenu.prototype.show = function (...args: any[]) {\n                self.initDisclosureMenu(this);\n                disclosureMenuShowFn.apply(this, args);\n            };\n\n            const disclosureMenuInitFn = Garnish.DisclosureMenu.prototype.init;\n            Garnish.DisclosureMenu.prototype.init = function (...args: any[]) {\n                disclosureMenuInitFn.apply(this, args);\n                self.initAddButtonMenu(this);\n                self.prepareEntryDropZones();\n            };\n\n            if (!this.settings.experimentalFeatures || !this.settings.enableDragDrop) {\n                return;\n            }\n\n            const matrixInitFn = Craft.MatrixInput.prototype.init;\n            Craft.MatrixInput.prototype.init = function (...args: any[]) {\n                matrixInitFn.apply(this, args);\n                this.entrySort.allowDragging = () => false;\n                this.entrySort.destroy();\n                self.prepareEntryDropZones();\n            };\n\n            Craft.MatrixInput.prototype.canAddMoreEntries = function () {\n                return (\n                    !this.maxEntries ||\n                    this.$entriesContainer.children(':not(.matrix-extended-drop-target)').length < this.maxEntries\n                );\n            };\n\n            this.itemDrag = new Garnish.DragDrop({\n                activeDropTargetClass: 'active',\n                minMouseDist: 10,\n                hideDraggee: false,\n                moveHelperToCursor: true,\n                handle: (item: any) => $(item).find('> .actions > .move, > .titlebar'),\n                filter: () => this.itemDrag.$targetItem.closest('.matrixblock'),\n                dropTargets: () => {\n                    if (!this.childParent) {\n                        return [];\n                    }\n\n                    const {entry, typeId} = this.itemDrag.$draggee.closest('.matrixblock').data();\n                    const matrix = entry.matrix;\n                    if (!matrix || !typeId) {\n                        return [];\n                    }\n                    // TODO check `canAddMore`, but only if drag and drop is between fields\n                    // const $allDropTargets = $('.matrix-extended-drop-target').filter((_, x) => !!$(x).data('canAddMore'));\n                    const $allDropTargets = $('.matrix-extended-drop-target')\n                        .filter((_: any, x: any) => (this.childParent[typeId] || []).includes($(x).data('entryTypeId')));\n\n                    return $allDropTargets.toArray().reverse();\n                },\n                onDragStart: () => {\n                    Garnish.$bod.addClass('dragging');\n                    this.itemDrag.$draggee.closest('.matrixblock').addClass('draggee');\n                    this.$dropEntry = this.itemDrag.$draggee.data('entry').$container;\n                    this.$pullBlock = this.$dropEntry.closest('.matrix-field');\n                },\n                // TODO find better way, like changing the owner. Currently clone & delete is used\n                onDragStop: async () => {\n                    this.itemDrag.$draggee.closest('.matrixblock').removeClass('draggee');\n                    if (!this.$dropEntry || !this.$pullBlock) {\n                        return this.itemDrag.returnHelpersToDraggees();\n                    }\n                    const $dropEntry = this.$dropEntry;\n                    const $dropTarget = this.itemDrag.$activeDropTarget;\n\n                    if (!$dropEntry || !$dropTarget) {\n                        return this.itemDrag.returnHelpersToDraggees();\n                    }\n\n                    let $relationEntry;\n                    let relationPosition = 'insertBefore';\n                    if ($dropTarget.data('position') === 'button') {\n                        $relationEntry = $dropTarget.closest('.matrix-field').find('> .blocks');\n                        relationPosition = 'appendTo';\n                    } else {\n                        $relationEntry = $dropTarget.next('.matrixblock');\n                    }\n\n                    const $pullBlock = this.$pullBlock;\n                    const $dropBlock = $dropTarget.closest('.matrix-field');\n                    if ($pullBlock.is($dropBlock)) {\n                        if (relationPosition === 'appendTo') {\n                            $dropEntry.appendTo($relationEntry);\n                        } else {\n                            $dropEntry.insertBefore($relationEntry);\n                        }\n\n                        // only update one block\n                        $pullBlock.data('matrix').entrySelect.resetItemOrder();\n                    } else {\n                        const matrix = $dropBlock.data('matrix');\n                        const entry = $dropEntry.data('entry');\n                        const typeId = $dropEntry.data('typeId');\n                        await this.duplicateWithNewOwner($relationEntry, relationPosition, typeId, entry, matrix)\n                        matrix.entrySelect.resetItemOrder();\n                        $pullBlock.data('matrix').entrySelect.resetItemOrder();\n                    }\n\n                    this.itemDrag.returnHelpersToDraggees();\n                    this.prepareEntryDropZones();\n                    Garnish.$bod.removeClass('dragging');\n                    this.$dropEntry = undefined;\n                    this.$pullBlock = undefined;\n                },\n            });\n        },\n\n        prepareEntryDropZones() {\n            if (!this.settings.experimentalFeatures || !this.settings.enableDragDrop) {\n                return;\n            }\n\n            const $fields = $('.matrix-field');\n            const $blocks = $fields.find('.matrixblock');\n\n            $('.matrix-extended-drop-target').remove();\n            for (const block of $blocks) {\n                const $block = $(block);\n\n                let $entryTypeId = null;\n                const entry = $block.data('entry');\n                if (!entry) {\n                    return;\n                }\n                const matrix = entry.matrix;\n                if (!matrix) {\n                    return;\n                }\n\n                $entryTypeId = matrix.settings.fieldId;\n\n                const $dropTargetBefore = $(`<div class=\"matrix-extended-drop-target\" data-position=\"block\"><div></div></div>`);\n                $dropTargetBefore.data($block.data());\n                $dropTargetBefore.data('entryTypeId', $entryTypeId);\n                $block.before($dropTargetBefore);\n            }\n\n            const $buttons = $fields.find('> .buttons');\n            for (const button of $buttons) {\n                const $button = $(button);\n\n                const matrix = $button.closest('.matrix-field').data('matrix');\n                if (!matrix) {\n                    continue;\n                }\n\n                const $dropTargetButton = $(`<div class=\"matrix-extended-drop-target\" data-position=\"button\"><div></div></div>`);\n                $dropTargetButton.data('entryTypeId', matrix.settings.fieldId);\n                $dropTargetButton.insertBefore($button);\n            }\n\n            this.itemDrag.removeAllItems();\n            this.itemDrag.addItems($blocks);\n            Garnish.$bod.addClass('matrix-extended-drag-drop');\n        },\n\n        initAddButtonMenu(disclosureMenu: any) {\n            if (!this.settings.experimentalFeatures || !this.settings.expandMenu) {\n                return;\n            }\n\n            const {$trigger, $container} = disclosureMenu;\n            const $parent = $trigger.parent();\n            const $wrapper = $trigger.closest('.matrix-field');\n            if (!$trigger || !$container || !$parent.hasClass('buttons') || !$wrapper.attr('id')) {\n                return;\n            }\n\n            if ($trigger._hasMatrixExtensionButtonsInitialized) {\n                return;\n            }\n            $trigger.hide();\n            $trigger._hasMatrixExtensionButtonsInitialized = true;\n\n            const $buttonContainer = $('<div class=\"buttons matrix-extended-buttons\"></div>')\n            const $actionButtons = $trigger\n                .disclosureMenu()\n                .data('disclosureMenu')\n                .$container.find('button')\n                .clone()\n                .off()\n                .on('activate', async (ev: any) => {\n                    const $button = $container.find('button').filter((_: any, x: any) => $(x).data('type') === $(ev.currentTarget).data('type'));\n                    $button.trigger('activate');\n                });\n\n            const id = $wrapper.attr('id').replace(/.*fields-/, '');\n            this.buildGroupedMenu($buttonContainer, $actionButtons, $trigger, id);\n\n            $buttonContainer.appendTo($parent);\n        },\n\n        initDisclosureMenu(disclosureMenu: any) {\n            const {$trigger, $container} = disclosureMenu;\n            if (!$trigger || !$container || !$trigger.hasClass('action-btn')) {\n                return;\n            }\n            const $element = $trigger.closest('.matrixblock');\n            if (!$element.length) {\n                return;\n            }\n            const {typeId, entry} = $element.data();\n            if (!typeId || !entry) {\n                return;\n            }\n\n            const matrix = entry.matrix;\n            if (!matrix) {\n                return;\n            }\n\n            if (disclosureMenu._hasMatrixExtensionButtonsInitialized) {\n                this.checkPaste($container, matrix);\n                this.checkDuplicate($container, matrix);\n                return;\n            }\n            disclosureMenu._hasMatrixExtensionButtonsInitialized = true;\n\n            this.addMenu($container, typeId, entry, matrix);\n        },\n\n        pasteEntry: async function (_: any, typeId: any, entry: any, matrix: any) {\n            if (matrix.addingEntry) {\n                // only one new entry at a time\n                return;\n            }\n\n            if (!matrix.canAddMoreEntries()) {\n                matrix.updateStatusMessage();\n                return;\n            }\n\n            matrix.addingEntry = true;\n\n            if (matrix.elementEditor) {\n                // First ensure we're working with drafts for all elements leading up\n                // to this field’s element\n                await matrix.elementEditor.setFormValue(matrix.settings.baseInputName, '*');\n            }\n\n            try {\n                const {data} = await Craft.sendActionRequest('POST', 'matrix-extended/matrix-extended/paste-entry', {\n                    data: {\n                        fieldId: matrix.settings.fieldId,\n                        entryId: entry.id,\n                        entryTypeId: typeId,\n                        ownerId: matrix.settings.ownerId,\n                        ownerElementType: matrix.settings.ownerElementType,\n                        siteId: matrix.settings.siteId,\n                        namespace: matrix.settings.namespace,\n                    },\n                });\n\n                const $entry = $(data.blockHtml);\n\n                // Pause the element editor\n                matrix.elementEditor?.pause();\n                $entry.insertAfter(entry.$container);\n\n                matrix.trigger('entryAdded', {\n                    $entry: $entry,\n                });\n\n                $entry.css('margin-bottom', '');\n                Craft.initUiElements($entry.children('.fields'));\n                await Craft.appendHeadHtml(data.headHtml);\n                await Craft.appendBodyHtml(data.bodyHtml);\n                new Craft.MatrixInput.Entry(matrix, $entry);\n                matrix.entrySort.addItems($entry);\n                matrix.entrySelect.addItems($entry);\n                matrix.updateAddEntryBtn();\n\n                // Animate the entry into position\n                $entry.css(matrix.getHiddenEntryCss($entry)).velocity({\n                    opacity: 1, 'margin-bottom': 10,\n                }, 'fast',);\n\n                Garnish.requestAnimationFrame(function () {\n                    // Resume the element editor\n                    matrix.elementEditor?.resume();\n                });\n\n            } catch (error) {\n                this.addStatusMessage(Craft.t('matrix-extended', 'There was an error pasting the entry'), 'error');\n            }\n\n            matrix.addingEntry = false;\n            entry.actionDisclosure.hide();\n        },\n\n        duplicateWithNewOwner: async function ($relationEntry: any, relationPosition: any, typeId: any, entry: any, matrix: any) {\n            if (matrix.addingEntry) {\n                // only one new entry at a time\n                return;\n            }\n\n            if (!matrix.canAddMoreEntries()) {\n                matrix.updateStatusMessage();\n                return;\n            }\n\n            matrix.addingEntry = true;\n\n            if (matrix.elementEditor) {\n                // First ensure we're working with drafts for all elements leading up\n                // to this field’s element\n                await matrix.elementEditor.setFormValue(matrix.settings.baseInputName, '*');\n            }\n\n            try {\n                const {data} = await Craft.sendActionRequest('POST', 'matrix-extended/matrix-extended/duplicate-entry-with-new-owner', {\n                    data: {\n                        fieldId: matrix.settings.fieldId,\n                        entryId: entry.id,\n                        entryTypeId: typeId,\n                        ownerId: matrix.settings.ownerId,\n                        ownerElementType: matrix.settings.ownerElementType,\n                        siteId: matrix.settings.siteId,\n                        namespace: matrix.settings.namespace,\n                    },\n                });\n\n                const $entry = $(data.blockHtml);\n\n                // Pause the element editor\n                matrix.elementEditor?.pause();\n\n                if (relationPosition === 'appendTo') {\n                    $entry.appendTo($relationEntry);\n                } else {\n                    $entry.insertBefore($relationEntry);\n                }\n                entry.$container.hide();\n\n                matrix.trigger('entryAdded', {\n                    $entry: $entry,\n                });\n\n                $entry.css('margin-bottom', '');\n                Craft.initUiElements($entry.children('.fields'));\n                await Craft.appendHeadHtml(data.headHtml);\n                await Craft.appendBodyHtml(data.bodyHtml);\n                new Craft.MatrixInput.Entry(matrix, $entry);\n                matrix.entrySort.addItems($entry);\n                matrix.entrySelect.addItems($entry);\n                matrix.updateAddEntryBtn();\n\n                // Animate the entry into position\n                $entry.css(matrix.getHiddenEntryCss($entry)).velocity({\n                    opacity: 1, 'margin-bottom': 10,\n                }, 'fast',);\n\n                Garnish.requestAnimationFrame(function () {\n                    // Resume the element editor\n                    matrix.elementEditor?.resume();\n                    entry.selfDestruct();\n                });\n            } catch (error) {\n                this.addStatusMessage(Craft.t('matrix-extended', 'There was an error dropping the entry'), 'error');\n            }\n\n            matrix.addingEntry = false;\n            entry.actionDisclosure.hide();\n        },\n\n        copyEntry: async function ($menu: any, typeId: any, entry: any, matrix: any) {\n            try {\n                const {data} = await Craft.sendActionRequest('POST', 'matrix-extended/matrix-extended/copy-entry', {\n                    data: {\n                        fieldId: matrix.settings.fieldId,\n                        entryId: entry.id,\n                        entryTypeId: typeId,\n                        ownerId: matrix.settings.ownerId,\n                        ownerElementType: matrix.settings.ownerElementType,\n                        siteId: matrix.settings.siteId,\n                        namespace: matrix.settings.namespace,\n                    },\n                });\n\n                this.entryReference = data.entryReference;\n                this.checkPaste($menu, matrix);\n                this.checkDuplicate($menu, matrix);\n                await Craft.appendHeadHtml(data.headHtml);\n                await Craft.appendBodyHtml(data.bodyHtml);\n                this._hasMatrixExtensionButtonsInitialized\n\n                this.addStatusMessage(Craft.t('matrix-extended', 'Entry reference copied'));\n            } catch (error) {\n                this.addStatusMessage(Craft.t('matrix-extended', 'There was an error copying the entry reference'), 'error');\n            }\n            entry.actionDisclosure.hide();\n        },\n\n        duplicateEntry: async function (_: any, typeId: any, entry: any, matrix: any) {\n            if (matrix.addingEntry) {\n                // only one new entry at a time\n                return;\n            }\n\n            if (!matrix.canAddMoreEntries()) {\n                matrix.updateStatusMessage();\n                return;\n            }\n\n            matrix.addingEntry = true;\n\n            if (matrix.elementEditor) {\n                // First ensure we're working with drafts for all elements leading up\n                // to this field’s element\n                await matrix.elementEditor.setFormValue(matrix.settings.baseInputName, '*');\n            }\n\n            try {\n                const {data} = await Craft.sendActionRequest('POST', 'matrix-extended/matrix-extended/duplicate-entry', {\n                    data: {\n                        fieldId: matrix.settings.fieldId,\n                        entryId: entry.id,\n                        entryTypeId: typeId,\n                        ownerId: matrix.settings.ownerId,\n                        ownerElementType: matrix.settings.ownerElementType,\n                        siteId: matrix.settings.siteId,\n                        namespace: matrix.settings.namespace,\n                    },\n                });\n\n                const $entry = $(data.blockHtml);\n\n                // Pause the element editor\n                matrix.elementEditor?.pause();\n                $entry.insertAfter(entry.$container);\n\n                matrix.trigger('entryAdded', {\n                    $entry: $entry,\n                });\n\n                $entry.css('margin-bottom', '');\n                Craft.initUiElements($entry.children('.fields'));\n                await Craft.appendHeadHtml(data.headHtml);\n                await Craft.appendBodyHtml(data.bodyHtml);\n                new Craft.MatrixInput.Entry(matrix, $entry);\n                matrix.entrySort.addItems($entry);\n                matrix.entrySelect.addItems($entry);\n                matrix.updateAddEntryBtn();\n\n                // Animate the entry into position\n                $entry.css(matrix.getHiddenEntryCss($entry)).velocity({\n                    opacity: 1, 'margin-bottom': 10,\n                }, 'fast',);\n\n                Garnish.requestAnimationFrame(function () {\n                    // Resume the element editor\n                    matrix.elementEditor?.resume();\n                });\n            } catch (error) {\n                this.addStatusMessage(Craft.t('matrix-extended', 'There was an error duplicating the entry'), 'error');\n            }\n\n            matrix.addingEntry = false;\n            entry.actionDisclosure.hide();\n        },\n\n        addMenu: function ($container: any, typeId: any, entry: any, matrix: any) {\n            const $menu = $('<ul class=\"matrix-extended\"></ul>');\n            const $hr = $('<hr class=\"padded\">');\n\n            this.addAddBlockButton($menu, typeId, entry, matrix);\n            this.addDuplicateButton($menu, typeId, entry, matrix);\n            this.addCopyButton($menu, typeId, entry, matrix);\n            this.addPasteButton($menu, typeId, entry, matrix);\n            this.addDeleteButton($menu, entry);\n            this.checkPaste($menu, matrix);\n            this.checkDuplicate($menu, matrix);\n\n            $menu.insertBefore($container.find('ul').eq(0));\n            $hr.insertAfter($menu);\n        },\n\n        addPasteButton: function ($menu: any, typeId: any, entry: any, matrix: any) {\n            if (!this.settings.experimentalFeatures) {\n                return;\n            }\n\n            const $pasteButton = $(`<li>\n            <button class=\"menu-item\" data-action=\"paste\" tabindex=\"0\">\n                        <span class=\"icon\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\"M104.6 48H64C28.7 48 0 76.7 0 112V384c0 35.3 28.7 64 64 64h96V400H64c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H80c0 17.7 14.3 32 32 32h72.4C202 108.4 227.6 96 256 96h62c-7.1-27.6-32.2-48-62-48H215.4C211.6 20.9 188.2 0 160 0s-51.6 20.9-55.4 48zM144 56a16 16 0 1 1 32 0 16 16 0 1 1 -32 0zM448 464H256c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16l140.1 0L464 243.9V448c0 8.8-7.2 16-16 16zM256 512H448c35.3 0 64-28.7 64-64V243.9c0-12.7-5.1-24.9-14.1-33.9l-67.9-67.9c-9-9-21.2-14.1-33.9-14.1H256c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64z\"/></svg>\n                        </span><span class=\"menu-item-label\">${Craft.t('matrix-extended', 'Paste')}</span>\n                    </button>\n                </li>`);\n            $menu.append($pasteButton);\n\n            $pasteButton.find('button').on('click', () => {\n                this.pasteEntry($menu, typeId, entry, matrix);\n            });\n        },\n\n        addAddBlockButton: function ($menu: any, _: any, entry: any, matrix: any) {\n            if (!this.settings.experimentalFeatures) {\n                return;\n            }\n\n            if (!matrix.$addEntryMenuBtn.length) {\n                return;\n            }\n\n            const $addBlockButton = $(`<li>\n                    <button class=\"menu-item\" data-action=\"add-block\" tabindex=\"0\">\n                        <span class=\"icon\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\"M64 80c-8.8 0-16 7.2-16 16V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V96c0-8.8-7.2-16-16-16H64zM0 96C0 60.7 28.7 32 64 32H384c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM200 344V280H136c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H248v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z\"/></svg>\n                        </span><span class=\"menu-item-label\">${Craft.t('matrix-extended', 'Add block above')}</span>\n                    </button>\n                </li>`);\n            $menu.append($addBlockButton);\n\n            $addBlockButton.find('button').on('click', () => {\n                const id = matrix.settings.namespace ? matrix.id.replace(/.*fields-/, '') : matrix.id;\n\n                $('.matrix-extended-buttons-above').remove();\n                $(`#matrix-extended-menu-${id}-all`).remove();\n\n                const $buttonContainer = $('<div class=\"buttons matrix-extended-buttons matrix-extended-buttons-above\"></div>')\n                const $actionButtons = matrix.$addEntryMenuBtn.data('disclosureMenu').$container.find('button').clone().off();\n\n                const $clone = Craft.ui\n                    .createButton({\n                        label: matrix.$addEntryMenuBtn.find('.label').text(), spinner: true,\n                    })\n                    .addClass('btn menubtn dashed add icon')\n                    .attr('aria-controls', `matrix-extended-menu-${id}-all`);\n\n                const $menuContainer = $(`<div class=\"menu menu--disclosure\" id=\"matrix-extended-menu-${id}-all\">`);\n                const $menu = $('<ul></ul>');\n\n                $menuContainer.append($menu);\n                $(document.body).append($menuContainer);\n                const disclosure = new Garnish.DisclosureMenu($clone);\n\n                for (const button of $actionButtons) {\n                    const $li = $(`<li></li>`);\n                    const $button = $(button);\n                    $li.append($button)\n                    $menu.append($li);\n                }\n\n                $actionButtons.on('activate', async (ev: any) => {\n                    $clone.addClass('loading');\n                    try {\n                        await matrix.addEntry($(ev.currentTarget).data('type'), entry.$container);\n                    } finally {\n                        disclosure.hide();\n                        $clone.remove();\n                        $menuContainer.remove();\n                        $buttonContainer.remove();\n                    }\n                });\n\n                if (this.settings.expandMenu) {\n                    const $container = $clone.data('disclosureMenu').$container;\n                    const $actionButtons = $container.find('button').clone(true, true);\n                    this.buildGroupedMenu($buttonContainer, $actionButtons, $clone, id);\n                } else {\n                    $buttonContainer.append($clone);\n                }\n\n                $buttonContainer.insertBefore(entry.$container);\n                entry.actionDisclosure.hide();\n            });\n        },\n\n        addCopyButton: function ($menu: any, typeId: any, entry: any, matrix: any) {\n            if (!this.settings.experimentalFeatures) {\n                return;\n            }\n\n            const $copyButton = $(`<li>\n                    <button class=\"menu-item\" data-action=\"copy\" tabindex=\"0\">\n                        <span class=\"icon\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\"M280 64h40c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128C0 92.7 28.7 64 64 64h40 9.6C121 27.5 153.3 0 192 0s71 27.5 78.4 64H280zM64 112c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16H320c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H304v24c0 13.3-10.7 24-24 24H192 104c-13.3 0-24-10.7-24-24V112H64zm128-8a24 24 0 1 0 0-48 24 24 0 1 0 0 48z\"/></svg>\n                        </span><span class=\"menu-item-label\">${Craft.t('matrix-extended', 'Copy')}</span>\n                    </button>\n                </li>`);\n            $menu.append($copyButton);\n\n            $copyButton.find('button').on('click', () => {\n                this.copyEntry($menu, typeId, entry, matrix);\n            });\n        },\n\n        addDuplicateButton: function ($menu: any, typeId: any, entry: any, matrix: any) {\n            const $duplicateButton = $(`<li>\n                <button class=\"menu-item\" data-action=\"duplicate\" tabindex=\"0\">\n                    <span class=\"icon\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\"M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z\"/></svg>\n                    </span><span class=\"menu-item-label\">${Craft.t('matrix-extended', 'Duplicate')}</span>\n                </button>\n            </li>`);\n            $menu.append($duplicateButton);\n\n            $duplicateButton.find('button').on('click', () => {\n                this.duplicateEntry($menu, typeId, entry, matrix);\n            });\n        },\n\n        addDeleteButton: function ($menu: any, entry: any) {\n            const $duplicateButton = $(`<li>\n                <button class=\"menu-item error\" data-action=\"delete\" tabindex=\"0\">\n                    <span class=\"icon\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d=\"M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z\"/></svg>\n                    </span><span class=\"menu-item-label\">${Craft.t('matrix-extended', 'Delete')}</span>\n                </button>\n            </li>`);\n            $menu.append($duplicateButton);\n\n            $duplicateButton.find('button').on('click', function () {\n                entry.selfDestruct();\n                entry.actionDisclosure.hide();\n            });\n        },\n\n        buildGroupedMenu: function ($buttonContainer: any, $actionButtons: any, $actionBtn: any, id: any) {\n            let $unused = $actionButtons;\n            if (!this.settings.fields) {\n                const $actionButtonContainer = $('<div class=\"btngroup matrix-extended-btngroup\"></div>')\n                $unused.first().addClass('add icon');\n                $unused.addClass('btn dashed');\n                $actionButtonContainer.append($unused);\n                $buttonContainer.append($actionButtonContainer)\n                return;\n            }\n\n            if (!this.settings.fields[id]) {\n                const $actionButtonContainer = $('<div class=\"btngroup matrix-extended-btngroup\"></div>')\n                $unused.first().addClass('add icon');\n                $unused.addClass('btn dashed');\n                $actionButtonContainer.append($unused);\n                $buttonContainer.append($actionButtonContainer)\n                return;\n            }\n\n            const fieldGroup: Record<string, { groups: any }> = this.settings.fields[id];\n            for (const [index, group] of Object.entries(fieldGroup.groups)) {\n                if ($(`matrix-extended-menu-${id}-${index}`).length) {\n                    continue;\n                }\n\n                const $groupedMenuButton = Craft.ui\n                    .createButton({\n                        label: group.label, spinner: true,\n                    })\n                    .addClass('btn menubtn dashed add icon')\n                    .attr('aria-controls', `matrix-extended-menu-${id}-${index}`)\n                    .appendTo($buttonContainer);\n                const $menuContainer = $(`<div class=\"menu menu--disclosure\" id=\"matrix-extended-menu-${id}-${index}\">`);\n                const $menu = $('<ul></ul>');\n\n                $menuContainer.append($menu);\n                $(document.body).append($menuContainer);\n                const disclosure = new Garnish.DisclosureMenu($groupedMenuButton);\n\n                for (const type of group.types) {\n                    const $li = $(`<li></li>`);\n                    const $button = $actionButtons.filter((_: any, x: any) => $(x).data('type') === type);\n                    $unused = $unused.filter((_: any, x: any) => $(x).data('type') !== type);\n                    if (!$button.length) {\n                        console.warn(`Type ${type} not found in group ${id}`)\n                        continue;\n                    }\n                    $li.append($button)\n                    $menu.append($li);\n                    $button.on('activate', () => disclosure.hide())\n                }\n            }\n\n            if (!$unused.length) {\n                return;\n            }\n\n            if (this.settings.expandUngrouped) {\n                const $actionButtonContainer = $('<div class=\"btngroup matrix-extended-btngroup\"></div>')\n                $unused.first().addClass('add icon');\n                $unused.addClass('btn dashed');\n                $actionButtonContainer.append($unused);\n                if (this.settings.ungroupedPosition === 'end') {\n                    $buttonContainer.append($actionButtonContainer)\n                } else {\n                    $buttonContainer.prepend($actionButtonContainer)\n                }\n                return;\n            }\n\n            const $groupedMenuButton = Craft.ui\n                .createButton({\n                    label: $actionBtn.find('.label').text(), spinner: true,\n                })\n                .addClass('btn menubtn dashed add icon')\n                .attr('aria-controls', `matrix-extended-menu-${id}-others`);\n\n            if (this.settings.ungroupedPosition === 'end') {\n                $groupedMenuButton.appendTo($buttonContainer);\n            } else {\n                $groupedMenuButton.prependTo($buttonContainer);\n            }\n\n            const $menuContainer = $(`<div class=\"menu menu--disclosure\" id=\"matrix-extended-menu-${id}-others\">`);\n            const $menu = $('<ul></ul>');\n\n            $menuContainer.append($menu);\n            $(document.body).append($menuContainer);\n            const disclosure = new Garnish.DisclosureMenu($groupedMenuButton);\n\n            for (const button of $unused) {\n                const $li = $(`<li></li>`);\n                const $button = $(button);\n                $li.append($button)\n                $menu.append($li);\n                $button.on('activate', () => disclosure.hide())\n            }\n        },\n\n        checkDuplicate: function ($container: any, matrix: any) {\n            const $duplicateButton = $container.find('button[data-action=\"duplicate\"]');\n            $duplicateButton.disable();\n            const $parent = $duplicateButton.parent();\n            $parent.attr('title', '');\n\n            if (!matrix.canAddMoreEntries()) {\n                $parent.attr('title', Craft.t('matrix-extended', 'No more entries can be added.'));\n                return;\n            }\n\n            $duplicateButton.enable();\n        },\n\n        checkPaste: function ($container: any, matrix: any) {\n            const $pasteButton = $container.find('button[data-action=\"paste\"]');\n            $pasteButton.disable();\n            const $parent = $pasteButton.parent();\n            $parent.attr('title', '');\n\n            if (!this.entryReference || !this.entryReference.entryTypeId) {\n                $parent.attr('title', Craft.t('matrix-extended', 'There is nothing to paste.'));\n                return;\n            }\n\n            if (!this.childParent) {\n                $parent.attr('title', Craft.t('matrix-extended', 'The copied entry is not allowed here.'));\n                return;\n            }\n\n\n            if (!matrix.canAddMoreEntries()) {\n                $parent.attr('title', Craft.t('matrix-extended', 'No more entries can be added.'));\n                return;\n            }\n\n            if (!(this.childParent[this.entryReference.entryTypeId] || []).includes(matrix.settings.fieldId)) {\n                $parent.attr('title', Craft.t('matrix-extended', 'The copied entry is not allowed here.'));\n                return;\n            }\n\n            $pasteButton.enable();\n        },\n\n        addStatusMessage: function (message: string, type: 'notice' | 'error' = 'notice') {\n            if (type === 'notice') {\n                Craft.cp.displayNotice(message);\n            }\n\n            if (type === 'error') {\n                Craft.cp.displayError(message);\n            }\n        }\n    });\n})(window);\n"],"names":["window","Craft","Garnish","$","config","self","disclosureMenuShowFn","args","disclosureMenuInitFn","matrixInitFn","item","entry","typeId","_","x","$dropEntry","$dropTarget","$relationEntry","relationPosition","$pullBlock","$dropBlock","matrix","$fields","$blocks","block","$block","$entryTypeId","$dropTargetBefore","$buttons","button","$button","$dropTargetButton","disclosureMenu","$trigger","$container","$parent","$wrapper","$buttonContainer","$actionButtons","ev","id","$element","_a","data","$entry","$menu","$hr","$pasteButton","$addBlockButton","$clone","$menuContainer","disclosure","$li","$copyButton","$duplicateButton","$actionBtn","$unused","$actionButtonContainer","fieldGroup","index","group","$groupedMenuButton","type","message"],"mappings":"CAAC,SAAUA,EAAa,CACpB,KAAM,CAAC,MAAAC,EAAO,QAAAC,EAAS,EAAAC,CAAA,EAAKH,EACxB,CAACC,GAAS,CAACC,GAAW,CAACC,IAIrBF,EAAA,eAAiBC,EAAQ,KAAK,OAAO,CACvC,SAAU,CAAC,EAAG,YAAa,CAAC,EAAG,eAAgB,OAAW,SAAU,OAEpE,KAAM,SAAUE,EAAkE,CAC9E,MAAMC,EAAO,KAMT,GALC,KAAA,SAAWD,EAAO,UAAY,CAAA,EAC9B,KAAA,YAAcA,EAAO,aAAe,CAAA,EACpC,KAAA,eAAiBA,EAAO,gBAAkB,OAG3C,CAACF,EAAQ,eACT,OAGE,MAAAI,EAAuBJ,EAAQ,eAAe,UAAU,KAC9DA,EAAQ,eAAe,UAAU,KAAO,YAAaK,EAAa,CAC9DF,EAAK,mBAAmB,IAAI,EACPC,EAAA,MAAM,KAAMC,CAAI,CAAA,EAGnC,MAAAC,EAAuBN,EAAQ,eAAe,UAAU,KAO9D,GANAA,EAAQ,eAAe,UAAU,KAAO,YAAaK,EAAa,CACzCC,EAAA,MAAM,KAAMD,CAAI,EACrCF,EAAK,kBAAkB,IAAI,EAC3BA,EAAK,sBAAsB,CAAA,EAG3B,CAAC,KAAK,SAAS,sBAAwB,CAAC,KAAK,SAAS,eACtD,OAGE,MAAAI,EAAeR,EAAM,YAAY,UAAU,KACjDA,EAAM,YAAY,UAAU,KAAO,YAAaM,EAAa,CAC5CE,EAAA,MAAM,KAAMF,CAAI,EACxB,KAAA,UAAU,cAAgB,IAAM,GACrC,KAAK,UAAU,UACfF,EAAK,sBAAsB,CAAA,EAGzBJ,EAAA,YAAY,UAAU,kBAAoB,UAAY,CAEpD,MAAA,CAAC,KAAK,YACN,KAAK,kBAAkB,SAAS,oCAAoC,EAAE,OAAS,KAAK,UAAA,EAIvF,KAAA,SAAW,IAAIC,EAAQ,SAAS,CACjC,sBAAuB,SACvB,aAAc,GACd,YAAa,GACb,mBAAoB,GACpB,OAASQ,GAAcP,EAAEO,CAAI,EAAE,KAAK,iCAAiC,EACrE,OAAQ,IAAM,KAAK,SAAS,YAAY,QAAQ,cAAc,EAC9D,YAAa,IAAM,CACX,GAAA,CAAC,KAAK,YACN,MAAO,GAGL,KAAA,CAAC,MAAAC,EAAO,OAAAC,CAAU,EAAA,KAAK,SAAS,SAAS,QAAQ,cAAc,EAAE,OAEnE,MAAA,CADWD,EAAM,QACN,CAACC,EACL,GAIaT,EAAE,8BAA8B,EACnD,OAAO,CAACU,EAAQC,KAAY,KAAK,YAAYF,CAAM,GAAK,CAAA,GAAI,SAAST,EAAEW,CAAC,EAAE,KAAK,aAAa,CAAC,CAAC,EAE5E,UAAU,SACrC,EACA,YAAa,IAAM,CACPZ,EAAA,KAAK,SAAS,UAAU,EAChC,KAAK,SAAS,SAAS,QAAQ,cAAc,EAAE,SAAS,SAAS,EACjE,KAAK,WAAa,KAAK,SAAS,SAAS,KAAK,OAAO,EAAE,WACvD,KAAK,WAAa,KAAK,WAAW,QAAQ,eAAe,CAC7D,EAEA,WAAY,SAAY,CAEpB,GADA,KAAK,SAAS,SAAS,QAAQ,cAAc,EAAE,YAAY,SAAS,EAChE,CAAC,KAAK,YAAc,CAAC,KAAK,WACnB,OAAA,KAAK,SAAS,0BAEzB,MAAMa,EAAa,KAAK,WAClBC,EAAc,KAAK,SAAS,kBAE9B,GAAA,CAACD,GAAc,CAACC,EACT,OAAA,KAAK,SAAS,0BAGrB,IAAAC,EACAC,EAAmB,eACnBF,EAAY,KAAK,UAAU,IAAM,UACjCC,EAAiBD,EAAY,QAAQ,eAAe,EAAE,KAAK,WAAW,EACnDE,EAAA,YAEFD,EAAAD,EAAY,KAAK,cAAc,EAGpD,MAAMG,EAAa,KAAK,WAClBC,EAAaJ,EAAY,QAAQ,eAAe,EAClD,GAAAG,EAAW,GAAGC,CAAU,EACpBF,IAAqB,WACrBH,EAAW,SAASE,CAAc,EAElCF,EAAW,aAAaE,CAAc,EAI1CE,EAAW,KAAK,QAAQ,EAAE,YAAY,eAAe,MAClD,CACG,MAAAE,EAASD,EAAW,KAAK,QAAQ,EACjCT,EAAQI,EAAW,KAAK,OAAO,EAC/BH,EAASG,EAAW,KAAK,QAAQ,EACvC,MAAM,KAAK,sBAAsBE,EAAgBC,EAAkBN,EAAQD,EAAOU,CAAM,EACxFA,EAAO,YAAY,iBACnBF,EAAW,KAAK,QAAQ,EAAE,YAAY,eAAe,CACzD,CAEA,KAAK,SAAS,0BACd,KAAK,sBAAsB,EACnBjB,EAAA,KAAK,YAAY,UAAU,EACnC,KAAK,WAAa,OAClB,KAAK,WAAa,MACtB,CAAA,CACH,CACL,EAEA,uBAAwB,CACpB,GAAI,CAAC,KAAK,SAAS,sBAAwB,CAAC,KAAK,SAAS,eACtD,OAGE,MAAAoB,EAAUnB,EAAE,eAAe,EAC3BoB,EAAUD,EAAQ,KAAK,cAAc,EAEzCnB,EAAA,8BAA8B,EAAE,SAClC,UAAWqB,KAASD,EAAS,CACnB,MAAAE,EAAStB,EAAEqB,CAAK,EAEtB,IAAIE,EAAe,KACb,MAAAf,EAAQc,EAAO,KAAK,OAAO,EACjC,GAAI,CAACd,EACD,OAEJ,MAAMU,EAASV,EAAM,OACrB,GAAI,CAACU,EACD,OAGJK,EAAeL,EAAO,SAAS,QAEzB,MAAAM,EAAoBxB,EAAE,kFAAkF,EAC5FwB,EAAA,KAAKF,EAAO,KAAM,CAAA,EAClBE,EAAA,KAAK,cAAeD,CAAY,EAClDD,EAAO,OAAOE,CAAiB,CACnC,CAEM,MAAAC,EAAWN,EAAQ,KAAK,YAAY,EAC1C,UAAWO,KAAUD,EAAU,CACrB,MAAAE,EAAU3B,EAAE0B,CAAM,EAElBR,EAASS,EAAQ,QAAQ,eAAe,EAAE,KAAK,QAAQ,EAC7D,GAAI,CAACT,EACD,SAGE,MAAAU,EAAoB5B,EAAE,mFAAmF,EAC/G4B,EAAkB,KAAK,cAAeV,EAAO,SAAS,OAAO,EAC7DU,EAAkB,aAAaD,CAAO,CAC1C,CAEA,KAAK,SAAS,iBACT,KAAA,SAAS,SAASP,CAAO,EACtBrB,EAAA,KAAK,SAAS,2BAA2B,CACrD,EAEA,kBAAkB8B,EAAqB,CACnC,GAAI,CAAC,KAAK,SAAS,sBAAwB,CAAC,KAAK,SAAS,WACtD,OAGE,KAAA,CAAC,SAAAC,EAAU,WAAAC,CAAc,EAAAF,EACzBG,EAAUF,EAAS,SACnBG,EAAWH,EAAS,QAAQ,eAAe,EAKjD,GAJI,CAACA,GAAY,CAACC,GAAc,CAACC,EAAQ,SAAS,SAAS,GAAK,CAACC,EAAS,KAAK,IAAI,GAI/EH,EAAS,sCACT,OAEJA,EAAS,KAAK,EACdA,EAAS,sCAAwC,GAE3C,MAAAI,EAAmBlC,EAAE,qDAAqD,EAC1EmC,EAAiBL,EAClB,eAAA,EACA,KAAK,gBAAgB,EACrB,WAAW,KAAK,QAAQ,EACxB,QACA,IAAA,EACA,GAAG,WAAY,MAAOM,GAAY,CACfL,EAAW,KAAK,QAAQ,EAAE,OAAO,CAACrB,EAAQC,IAAWX,EAAEW,CAAC,EAAE,KAAK,MAAM,IAAMX,EAAEoC,EAAG,aAAa,EAAE,KAAK,MAAM,CAAC,EACnH,QAAQ,UAAU,CAAA,CAC7B,EAECC,EAAKJ,EAAS,KAAK,IAAI,EAAE,QAAQ,YAAa,EAAE,EACtD,KAAK,iBAAiBC,EAAkBC,EAAgBL,EAAUO,CAAE,EAEpEH,EAAiB,SAASF,CAAO,CACrC,EAEA,mBAAmBH,EAAqB,CAC9B,KAAA,CAAC,SAAAC,EAAU,WAAAC,CAAc,EAAAF,EAC3B,GAAA,CAACC,GAAY,CAACC,GAAc,CAACD,EAAS,SAAS,YAAY,EAC3D,OAEE,MAAAQ,EAAWR,EAAS,QAAQ,cAAc,EAC5C,GAAA,CAACQ,EAAS,OACV,OAEJ,KAAM,CAAC,OAAA7B,EAAQ,MAAAD,CAAK,EAAI8B,EAAS,KAAK,EAClC,GAAA,CAAC7B,GAAU,CAACD,EACZ,OAGJ,MAAMU,EAASV,EAAM,OACrB,GAAKU,EAIL,IAAIW,EAAe,sCAAuC,CACjD,KAAA,WAAWE,EAAYb,CAAM,EAC7B,KAAA,eAAea,EAAYb,CAAM,EACtC,MACJ,CACAW,EAAe,sCAAwC,GAEvD,KAAK,QAAQE,EAAYtB,EAAQD,EAAOU,CAAM,EAClD,EAEA,WAAY,eAAgBR,EAAQD,EAAaD,EAAYU,EAAa,CAvPjF,IAAAqB,EAwPW,GAAI,CAAArB,EAAO,YAKP,IAAA,CAACA,EAAO,oBAAqB,CAC7BA,EAAO,oBAAoB,EAC3B,MACJ,CAEAA,EAAO,YAAc,GAEjBA,EAAO,eAGP,MAAMA,EAAO,cAAc,aAAaA,EAAO,SAAS,cAAe,GAAG,EAG1E,GAAA,CACA,KAAM,CAAC,KAAAsB,CAAI,EAAI,MAAM1C,EAAM,kBAAkB,OAAQ,8CAA+C,CAChG,KAAM,CACF,QAASoB,EAAO,SAAS,QACzB,QAASV,EAAM,GACf,YAAaC,EACb,QAASS,EAAO,SAAS,QACzB,iBAAkBA,EAAO,SAAS,iBAClC,OAAQA,EAAO,SAAS,OACxB,UAAWA,EAAO,SAAS,SAC/B,CAAA,CACH,EAEKuB,EAASzC,EAAEwC,EAAK,SAAS,GAG/BD,EAAArB,EAAO,gBAAP,MAAAqB,EAAsB,QACfE,EAAA,YAAYjC,EAAM,UAAU,EAEnCU,EAAO,QAAQ,aAAc,CACzB,OAAAuB,CAAA,CACH,EAEMA,EAAA,IAAI,gBAAiB,EAAE,EAC9B3C,EAAM,eAAe2C,EAAO,SAAS,SAAS,CAAC,EACzC,MAAA3C,EAAM,eAAe0C,EAAK,QAAQ,EAClC,MAAA1C,EAAM,eAAe0C,EAAK,QAAQ,EACxC,IAAI1C,EAAM,YAAY,MAAMoB,EAAQuB,CAAM,EACnCvB,EAAA,UAAU,SAASuB,CAAM,EACzBvB,EAAA,YAAY,SAASuB,CAAM,EAClCvB,EAAO,kBAAkB,EAGzBuB,EAAO,IAAIvB,EAAO,kBAAkBuB,CAAM,CAAC,EAAE,SAAS,CAClD,QAAS,EAAG,gBAAiB,IAC9B,MAAO,EAEV1C,EAAQ,sBAAsB,UAAY,CA/SzD,IAAAwC,GAiTmBA,EAAArB,EAAO,gBAAP,MAAAqB,EAAsB,QAAO,CAChC,OAEW,CACZ,KAAK,iBAAiBzC,EAAM,EAAE,kBAAmB,sCAAsC,EAAG,OAAO,CACrG,CAEAoB,EAAO,YAAc,GACrBV,EAAM,iBAAiB,OAC3B,EAEA,sBAAuB,eAAgBM,EAAqBC,EAAuBN,EAAaD,EAAYU,EAAa,CA5ThI,IAAAqB,EA6TW,GAAI,CAAArB,EAAO,YAKP,IAAA,CAACA,EAAO,oBAAqB,CAC7BA,EAAO,oBAAoB,EAC3B,MACJ,CAEAA,EAAO,YAAc,GAEjBA,EAAO,eAGP,MAAMA,EAAO,cAAc,aAAaA,EAAO,SAAS,cAAe,GAAG,EAG1E,GAAA,CACA,KAAM,CAAC,KAAAsB,CAAI,EAAI,MAAM1C,EAAM,kBAAkB,OAAQ,iEAAkE,CACnH,KAAM,CACF,QAASoB,EAAO,SAAS,QACzB,QAASV,EAAM,GACf,YAAaC,EACb,QAASS,EAAO,SAAS,QACzB,iBAAkBA,EAAO,SAAS,iBAClC,OAAQA,EAAO,SAAS,OACxB,UAAWA,EAAO,SAAS,SAC/B,CAAA,CACH,EAEKuB,EAASzC,EAAEwC,EAAK,SAAS,GAG/BD,EAAArB,EAAO,gBAAP,MAAAqB,EAAsB,QAElBxB,IAAqB,WACrB0B,EAAO,SAAS3B,CAAc,EAE9B2B,EAAO,aAAa3B,CAAc,EAEtCN,EAAM,WAAW,OAEjBU,EAAO,QAAQ,aAAc,CACzB,OAAAuB,CAAA,CACH,EAEMA,EAAA,IAAI,gBAAiB,EAAE,EAC9B3C,EAAM,eAAe2C,EAAO,SAAS,SAAS,CAAC,EACzC,MAAA3C,EAAM,eAAe0C,EAAK,QAAQ,EAClC,MAAA1C,EAAM,eAAe0C,EAAK,QAAQ,EACxC,IAAI1C,EAAM,YAAY,MAAMoB,EAAQuB,CAAM,EACnCvB,EAAA,UAAU,SAASuB,CAAM,EACzBvB,EAAA,YAAY,SAASuB,CAAM,EAClCvB,EAAO,kBAAkB,EAGzBuB,EAAO,IAAIvB,EAAO,kBAAkBuB,CAAM,CAAC,EAAE,SAAS,CAClD,QAAS,EAAG,gBAAiB,IAC9B,MAAO,EAEV1C,EAAQ,sBAAsB,UAAY,CA1XzD,IAAAwC,GA4XmBA,EAAArB,EAAO,gBAAP,MAAAqB,EAAsB,SACtB/B,EAAM,aAAa,CAAA,CACtB,OACW,CACZ,KAAK,iBAAiBV,EAAM,EAAE,kBAAmB,uCAAuC,EAAG,OAAO,CACtG,CAEAoB,EAAO,YAAc,GACrBV,EAAM,iBAAiB,OAC3B,EAEA,UAAW,eAAgBkC,EAAYjC,EAAaD,EAAYU,EAAa,CACrE,GAAA,CACA,KAAM,CAAC,KAAAsB,CAAI,EAAI,MAAM1C,EAAM,kBAAkB,OAAQ,6CAA8C,CAC/F,KAAM,CACF,QAASoB,EAAO,SAAS,QACzB,QAASV,EAAM,GACf,YAAaC,EACb,QAASS,EAAO,SAAS,QACzB,iBAAkBA,EAAO,SAAS,iBAClC,OAAQA,EAAO,SAAS,OACxB,UAAWA,EAAO,SAAS,SAC/B,CAAA,CACH,EAED,KAAK,eAAiBsB,EAAK,eACtB,KAAA,WAAWE,EAAOxB,CAAM,EACxB,KAAA,eAAewB,EAAOxB,CAAM,EAC3B,MAAApB,EAAM,eAAe0C,EAAK,QAAQ,EAClC,MAAA1C,EAAM,eAAe0C,EAAK,QAAQ,EACnC,KAAA,sCAEL,KAAK,iBAAiB1C,EAAM,EAAE,kBAAmB,wBAAwB,CAAC,OAC9D,CACZ,KAAK,iBAAiBA,EAAM,EAAE,kBAAmB,gDAAgD,EAAG,OAAO,CAC/G,CACAU,EAAM,iBAAiB,MAC3B,EAEA,eAAgB,eAAgBE,EAAQD,EAAaD,EAAYU,EAAa,CAnarF,IAAAqB,EAoaW,GAAI,CAAArB,EAAO,YAKP,IAAA,CAACA,EAAO,oBAAqB,CAC7BA,EAAO,oBAAoB,EAC3B,MACJ,CAEAA,EAAO,YAAc,GAEjBA,EAAO,eAGP,MAAMA,EAAO,cAAc,aAAaA,EAAO,SAAS,cAAe,GAAG,EAG1E,GAAA,CACA,KAAM,CAAC,KAAAsB,CAAI,EAAI,MAAM1C,EAAM,kBAAkB,OAAQ,kDAAmD,CACpG,KAAM,CACF,QAASoB,EAAO,SAAS,QACzB,QAASV,EAAM,GACf,YAAaC,EACb,QAASS,EAAO,SAAS,QACzB,iBAAkBA,EAAO,SAAS,iBAClC,OAAQA,EAAO,SAAS,OACxB,UAAWA,EAAO,SAAS,SAC/B,CAAA,CACH,EAEKuB,EAASzC,EAAEwC,EAAK,SAAS,GAG/BD,EAAArB,EAAO,gBAAP,MAAAqB,EAAsB,QACfE,EAAA,YAAYjC,EAAM,UAAU,EAEnCU,EAAO,QAAQ,aAAc,CACzB,OAAAuB,CAAA,CACH,EAEMA,EAAA,IAAI,gBAAiB,EAAE,EAC9B3C,EAAM,eAAe2C,EAAO,SAAS,SAAS,CAAC,EACzC,MAAA3C,EAAM,eAAe0C,EAAK,QAAQ,EAClC,MAAA1C,EAAM,eAAe0C,EAAK,QAAQ,EACxC,IAAI1C,EAAM,YAAY,MAAMoB,EAAQuB,CAAM,EACnCvB,EAAA,UAAU,SAASuB,CAAM,EACzBvB,EAAA,YAAY,SAASuB,CAAM,EAClCvB,EAAO,kBAAkB,EAGzBuB,EAAO,IAAIvB,EAAO,kBAAkBuB,CAAM,CAAC,EAAE,SAAS,CAClD,QAAS,EAAG,gBAAiB,IAC9B,MAAO,EAEV1C,EAAQ,sBAAsB,UAAY,CA3dzD,IAAAwC,GA6dmBA,EAAArB,EAAO,gBAAP,MAAAqB,EAAsB,QAAO,CAChC,OACW,CACZ,KAAK,iBAAiBzC,EAAM,EAAE,kBAAmB,0CAA0C,EAAG,OAAO,CACzG,CAEAoB,EAAO,YAAc,GACrBV,EAAM,iBAAiB,OAC3B,EAEA,QAAS,SAAUuB,EAAiBtB,EAAaD,EAAYU,EAAa,CAChE,MAAAwB,EAAQ1C,EAAE,mCAAmC,EAC7C2C,EAAM3C,EAAE,qBAAqB,EAEnC,KAAK,kBAAkB0C,EAAOjC,EAAQD,EAAOU,CAAM,EACnD,KAAK,mBAAmBwB,EAAOjC,EAAQD,EAAOU,CAAM,EACpD,KAAK,cAAcwB,EAAOjC,EAAQD,EAAOU,CAAM,EAC/C,KAAK,eAAewB,EAAOjC,EAAQD,EAAOU,CAAM,EAC3C,KAAA,gBAAgBwB,EAAOlC,CAAK,EAC5B,KAAA,WAAWkC,EAAOxB,CAAM,EACxB,KAAA,eAAewB,EAAOxB,CAAM,EAEjCwB,EAAM,aAAaX,EAAW,KAAK,IAAI,EAAE,GAAG,CAAC,CAAC,EAC9CY,EAAI,YAAYD,CAAK,CACzB,EAEA,eAAgB,SAAUA,EAAYjC,EAAaD,EAAYU,EAAa,CACpE,GAAA,CAAC,KAAK,SAAS,qBACf,OAGJ,MAAM0B,EAAe5C,EAAE;AAAA;AAAA;AAAA;AAAA,+DAI4BF,EAAM,EAAE,kBAAmB,OAAO,CAAC;AAAA;AAAA,sBAE5E,EACV4C,EAAM,OAAOE,CAAY,EAEzBA,EAAa,KAAK,QAAQ,EAAE,GAAG,QAAS,IAAM,CAC1C,KAAK,WAAWF,EAAOjC,EAAQD,EAAOU,CAAM,CAAA,CAC/C,CACL,EAEA,kBAAmB,SAAUwB,EAAYhC,EAAQF,EAAYU,EAAa,CAKlE,GAJA,CAAC,KAAK,SAAS,sBAIf,CAACA,EAAO,iBAAiB,OACzB,OAGJ,MAAM2B,EAAkB7C,EAAE;AAAA;AAAA;AAAA;AAAA,+DAIyBF,EAAM,EAAE,kBAAmB,iBAAiB,CAAC;AAAA;AAAA,sBAEtF,EACV4C,EAAM,OAAOG,CAAe,EAE5BA,EAAgB,KAAK,QAAQ,EAAE,GAAG,QAAS,IAAM,CACvC,MAAAR,EAAKnB,EAAO,SAAS,UAAYA,EAAO,GAAG,QAAQ,YAAa,EAAE,EAAIA,EAAO,GAEjFlB,EAAA,gCAAgC,EAAE,SACpCA,EAAE,yBAAyBqC,CAAE,MAAM,EAAE,SAE/B,MAAAH,EAAmBlC,EAAE,mFAAmF,EACxGmC,EAAiBjB,EAAO,iBAAiB,KAAK,gBAAgB,EAAE,WAAW,KAAK,QAAQ,EAAE,MAAM,EAAE,IAAI,EAEtG4B,EAAShD,EAAM,GAChB,aAAa,CACV,MAAOoB,EAAO,iBAAiB,KAAK,QAAQ,EAAE,KAAK,EAAG,QAAS,EAAA,CAClE,EACA,SAAS,6BAA6B,EACtC,KAAK,gBAAiB,wBAAwBmB,CAAE,MAAM,EAErDU,EAAiB/C,EAAE,+DAA+DqC,CAAE,QAAQ,EAC5FK,EAAQ1C,EAAE,WAAW,EAE3B+C,EAAe,OAAOL,CAAK,EAC3B1C,EAAE,SAAS,IAAI,EAAE,OAAO+C,CAAc,EACtC,MAAMC,EAAa,IAAIjD,EAAQ,eAAe+C,CAAM,EAEpD,UAAWpB,KAAUS,EAAgB,CAC3B,MAAAc,EAAMjD,EAAE,WAAW,EACnB2B,EAAU3B,EAAE0B,CAAM,EACxBuB,EAAI,OAAOtB,CAAO,EAClBe,EAAM,OAAOO,CAAG,CACpB,CAcI,GAZWd,EAAA,GAAG,WAAY,MAAOC,GAAY,CAC7CU,EAAO,SAAS,SAAS,EACrB,GAAA,CACM,MAAA5B,EAAO,SAASlB,EAAEoC,EAAG,aAAa,EAAE,KAAK,MAAM,EAAG5B,EAAM,UAAU,CAAA,QAC1E,CACEwC,EAAW,KAAK,EAChBF,EAAO,OAAO,EACdC,EAAe,OAAO,EACtBb,EAAiB,OAAO,CAC5B,CAAA,CACH,EAEG,KAAK,SAAS,WAAY,CAE1B,MAAMC,EADaW,EAAO,KAAK,gBAAgB,EAAE,WACf,KAAK,QAAQ,EAAE,MAAM,GAAM,EAAI,EACjE,KAAK,iBAAiBZ,EAAkBC,EAAgBW,EAAQT,CAAE,CAAA,MAElEH,EAAiB,OAAOY,CAAM,EAGjBZ,EAAA,aAAa1B,EAAM,UAAU,EAC9CA,EAAM,iBAAiB,MAAK,CAC/B,CACL,EAEA,cAAe,SAAUkC,EAAYjC,EAAaD,EAAYU,EAAa,CACnE,GAAA,CAAC,KAAK,SAAS,qBACf,OAGJ,MAAMgC,EAAclD,EAAE;AAAA;AAAA;AAAA;AAAA,+DAI6BF,EAAM,EAAE,kBAAmB,MAAM,CAAC;AAAA;AAAA,sBAE3E,EACV4C,EAAM,OAAOQ,CAAW,EAExBA,EAAY,KAAK,QAAQ,EAAE,GAAG,QAAS,IAAM,CACzC,KAAK,UAAUR,EAAOjC,EAAQD,EAAOU,CAAM,CAAA,CAC9C,CACL,EAEA,mBAAoB,SAAUwB,EAAYjC,EAAaD,EAAYU,EAAa,CAC5E,MAAMiC,EAAmBnD,EAAE;AAAA;AAAA;AAAA;AAAA,2DAIoBF,EAAM,EAAE,kBAAmB,WAAW,CAAC;AAAA;AAAA,kBAEhF,EACN4C,EAAM,OAAOS,CAAgB,EAE7BA,EAAiB,KAAK,QAAQ,EAAE,GAAG,QAAS,IAAM,CAC9C,KAAK,eAAeT,EAAOjC,EAAQD,EAAOU,CAAM,CAAA,CACnD,CACL,EAEA,gBAAiB,SAAUwB,EAAYlC,EAAY,CAC/C,MAAM2C,EAAmBnD,EAAE;AAAA;AAAA;AAAA;AAAA,2DAIoBF,EAAM,EAAE,kBAAmB,QAAQ,CAAC;AAAA;AAAA,kBAE7E,EACN4C,EAAM,OAAOS,CAAgB,EAE7BA,EAAiB,KAAK,QAAQ,EAAE,GAAG,QAAS,UAAY,CACpD3C,EAAM,aAAa,EACnBA,EAAM,iBAAiB,MAAK,CAC/B,CACL,EAEA,iBAAkB,SAAU0B,EAAuBC,EAAqBiB,EAAiBf,EAAS,CAC9F,IAAIgB,EAAUlB,EACV,GAAA,CAAC,KAAK,SAAS,OAAQ,CACjB,MAAAmB,EAAyBtD,EAAE,uDAAuD,EAChFqD,EAAA,MAAA,EAAQ,SAAS,UAAU,EACnCA,EAAQ,SAAS,YAAY,EAC7BC,EAAuB,OAAOD,CAAO,EACrCnB,EAAiB,OAAOoB,CAAsB,EAC9C,MACJ,CAEA,GAAI,CAAC,KAAK,SAAS,OAAOjB,CAAE,EAAG,CACrB,MAAAiB,EAAyBtD,EAAE,uDAAuD,EAChFqD,EAAA,MAAA,EAAQ,SAAS,UAAU,EACnCA,EAAQ,SAAS,YAAY,EAC7BC,EAAuB,OAAOD,CAAO,EACrCnB,EAAiB,OAAOoB,CAAsB,EAC9C,MACJ,CAEA,MAAMC,EAA8C,KAAK,SAAS,OAAOlB,CAAE,EAChE,SAAA,CAACmB,EAAOC,CAAK,IAAK,OAAO,QAAQF,EAAW,MAAM,EAAG,CAC5D,GAAIvD,EAAE,wBAAwBqC,CAAE,IAAImB,CAAK,EAAE,EAAE,OACzC,SAGEE,MAAAA,EAAqB5D,EAAM,GAC5B,aAAa,CACV,MAAO2D,EAAM,MAAO,QAAS,EAChC,CAAA,EACA,SAAS,6BAA6B,EACtC,KAAK,gBAAiB,wBAAwBpB,CAAE,IAAImB,CAAK,EAAE,EAC3D,SAAStB,CAAgB,EACxBa,EAAiB/C,EAAE,+DAA+DqC,CAAE,IAAImB,CAAK,IAAI,EACjGd,EAAQ1C,EAAE,WAAW,EAE3B+C,EAAe,OAAOL,CAAK,EAC3B1C,EAAE,SAAS,IAAI,EAAE,OAAO+C,CAAc,EACtC,MAAMC,EAAa,IAAIjD,EAAQ,eAAe2D,CAAkB,EAErD,UAAAC,KAAQF,EAAM,MAAO,CACtB,MAAAR,EAAMjD,EAAE,WAAW,EACnB2B,EAAUQ,EAAe,OAAO,CAACzB,EAAQC,IAAWX,EAAEW,CAAC,EAAE,KAAK,MAAM,IAAMgD,CAAI,EAEhF,GADMN,EAAAA,EAAQ,OAAO,CAAC3C,EAAQC,IAAWX,EAAEW,CAAC,EAAE,KAAK,MAAM,IAAMgD,CAAI,EACnE,CAAChC,EAAQ,OAAQ,CACjB,QAAQ,KAAK,QAAQgC,CAAI,uBAAuBtB,CAAE,EAAE,EACpD,QACJ,CACAY,EAAI,OAAOtB,CAAO,EAClBe,EAAM,OAAOO,CAAG,EAChBtB,EAAQ,GAAG,WAAY,IAAMqB,EAAW,KAAM,CAAA,CAClD,CACJ,CAEI,GAAA,CAACK,EAAQ,OACT,OAGA,GAAA,KAAK,SAAS,gBAAiB,CACzB,MAAAC,EAAyBtD,EAAE,uDAAuD,EAChFqD,EAAA,MAAA,EAAQ,SAAS,UAAU,EACnCA,EAAQ,SAAS,YAAY,EAC7BC,EAAuB,OAAOD,CAAO,EACjC,KAAK,SAAS,oBAAsB,MACpCnB,EAAiB,OAAOoB,CAAsB,EAE9CpB,EAAiB,QAAQoB,CAAsB,EAEnD,MACJ,CAEM,MAAAI,EAAqB5D,EAAM,GAC5B,aAAa,CACV,MAAOsD,EAAW,KAAK,QAAQ,EAAE,KAAK,EAAG,QAAS,EAAA,CACrD,EACA,SAAS,6BAA6B,EACtC,KAAK,gBAAiB,wBAAwBf,CAAE,SAAS,EAE1D,KAAK,SAAS,oBAAsB,MACpCqB,EAAmB,SAASxB,CAAgB,EAE5CwB,EAAmB,UAAUxB,CAAgB,EAGjD,MAAMa,EAAiB/C,EAAE,+DAA+DqC,CAAE,WAAW,EAC/FK,EAAQ1C,EAAE,WAAW,EAE3B+C,EAAe,OAAOL,CAAK,EAC3B1C,EAAE,SAAS,IAAI,EAAE,OAAO+C,CAAc,EACtC,MAAMC,EAAa,IAAIjD,EAAQ,eAAe2D,CAAkB,EAEhE,UAAWhC,KAAU2B,EAAS,CACpB,MAAAJ,EAAMjD,EAAE,WAAW,EACnB2B,EAAU3B,EAAE0B,CAAM,EACxBuB,EAAI,OAAOtB,CAAO,EAClBe,EAAM,OAAOO,CAAG,EAChBtB,EAAQ,GAAG,WAAY,IAAMqB,EAAW,KAAM,CAAA,CAClD,CACJ,EAEA,eAAgB,SAAUjB,EAAiBb,EAAa,CAC9C,MAAAiC,EAAmBpB,EAAW,KAAK,iCAAiC,EAC1EoB,EAAiB,QAAQ,EACnB,MAAAnB,EAAUmB,EAAiB,SAG7B,GAFInB,EAAA,KAAK,QAAS,EAAE,EAEpB,CAACd,EAAO,oBAAqB,CAC7Bc,EAAQ,KAAK,QAASlC,EAAM,EAAE,kBAAmB,+BAA+B,CAAC,EACjF,MACJ,CAEAqD,EAAiB,OAAO,CAC5B,EAEA,WAAY,SAAUpB,EAAiBb,EAAa,CAC1C,MAAA0B,EAAeb,EAAW,KAAK,6BAA6B,EAClEa,EAAa,QAAQ,EACf,MAAAZ,EAAUY,EAAa,SAG7B,GAFQZ,EAAA,KAAK,QAAS,EAAE,EAEpB,CAAC,KAAK,gBAAkB,CAAC,KAAK,eAAe,YAAa,CAC1DA,EAAQ,KAAK,QAASlC,EAAM,EAAE,kBAAmB,4BAA4B,CAAC,EAC9E,MACJ,CAEI,GAAA,CAAC,KAAK,YAAa,CACnBkC,EAAQ,KAAK,QAASlC,EAAM,EAAE,kBAAmB,uCAAuC,CAAC,EACzF,MACJ,CAGI,GAAA,CAACoB,EAAO,oBAAqB,CAC7Bc,EAAQ,KAAK,QAASlC,EAAM,EAAE,kBAAmB,+BAA+B,CAAC,EACjF,MACJ,CAEA,GAAI,EAAE,KAAK,YAAY,KAAK,eAAe,WAAW,GAAK,CAAA,GAAI,SAASoB,EAAO,SAAS,OAAO,EAAG,CAC9Fc,EAAQ,KAAK,QAASlC,EAAM,EAAE,kBAAmB,uCAAuC,CAAC,EACzF,MACJ,CAEA8C,EAAa,OAAO,CACxB,EAEA,iBAAkB,SAAUgB,EAAiBD,EAA2B,SAAU,CAC1EA,IAAS,UACH7D,EAAA,GAAG,cAAc8D,CAAO,EAG9BD,IAAS,SACH7D,EAAA,GAAG,aAAa8D,CAAO,CAErC,CAAA,CACH,EACL,GAAG,MAAM"}
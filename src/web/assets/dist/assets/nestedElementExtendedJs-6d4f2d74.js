(function(y){const{Craft:d,Garnish:l,$:c}=y;!d||!l||!c||(d.NestedElementExtended=l.Base.extend({settings:{},childParent:{},helper:void 0,init:function(a,n){const s=this;if(this.settings=a.settings||{},this.childParent=a.childParent||{},this.helper=n,!l.DisclosureMenu||!d.NestedElementManager)return;const e=d.NestedElementManager.prototype.init;d.NestedElementManager.prototype.init=function(...i){e.apply(this,i)};const t=l.DisclosureMenu.prototype.show;l.DisclosureMenu.prototype.show=function(...i){s.initDisclosureMenu(this),t.apply(this,i)}},initDisclosureMenu(a){if(!this.settings.experimentalFeatures)return;const{$trigger:n,$container:s}=a;if(!n||!s||!n.hasClass("action-btn"))return;const e=n.closest(".card-actions").parent(".card-actions-container").parent(".card");if(!e.length)return;const{typeId:t,id:i}=e.data();if(!t||!i)return;const r=e.closest(".nested-element-cards").data("nestedElementManager");if(r&&!(r.settings.mode!=="cards"||!r.settings.canCreate)){if(a._hasNestedElementExtensionButtonsInitialized){this.checkPaste(s,e,r),this.checkDuplicate(s,r);return}a._hasNestedElementExtensionButtonsInitialized=!0,this.addMenu(s,t,e,r)}},addMenu:function(a,n,s,e){const t=c('<ul class="matrix-extended"></ul>'),i=c('<hr class="padded">');this.addDuplicateButton(a,t,n,s,e),this.addCopyButton(a,t,n,s,e),this.addPasteButton(a,t,n,s,e),t.insertBefore(a.find("ul").eq(0)),i.insertAfter(t),this.checkPaste(a,s,e),this.checkDuplicate(a,e)},addDuplicateButton:function(a,n,s,e,t){const i=c(`<li>
                <button class="menu-item" data-action="duplicate" tabindex="0">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z"/></svg>
                    </span><span class="menu-item-label">${d.t("matrix-extended","Duplicate")}</span>
                </button>
            </li>`);n.append(i),i.find("button").on("click",()=>{this.duplicateEntry(a,n,s,e,t)})},duplicateEntry:async function(a,n,s,e,t){if(t.canCreate()){try{await t.markAsDirty();const{data:i}=await d.sendActionRequest("POST","matrix-extended/nested-element-extended/duplicate-entry",{data:{fieldId:e.data().fieldId,entryId:e.data().id,entryTypeId:s,ownerId:t.settings.ownerId,ownerElementType:t.settings.ownerElementType,siteId:t.settings.ownerSiteId}});await this.addElementCard(i,t,e.data("id"))}catch{this.addStatusMessage(d.t("matrix-extended","There was an error duplicating the entry"),"error")}a.data("disclosureMenu").hide()}},checkDuplicate:function(a,n){const s=a.find('button[data-action="duplicate"]');s.disable();const e=s.parent();if(e.attr("title",""),!n.canCreate()){e.attr("title",d.t("matrix-extended","No more entries can be added."));return}s.enable()},addCopyButton:function(a,n,s,e,t){const i=c(`<li>
                    <button class="menu-item" data-action="copy" tabindex="0">
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M280 64h40c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128C0 92.7 28.7 64 64 64h40 9.6C121 27.5 153.3 0 192 0s71 27.5 78.4 64H280zM64 112c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16H320c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H304v24c0 13.3-10.7 24-24 24H192 104c-13.3 0-24-10.7-24-24V112H64zm128-8a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"/></svg>
                        </span><span class="menu-item-label">${d.t("matrix-extended","Copy")}</span>
                    </button>
                </li>`);n.append(i),i.find("button").on("click",()=>{this.copyEntry(a,n,s,e,t)})},copyEntry:async function(a,n,s,e,t){try{const{data:i}=await d.sendActionRequest("POST","matrix-extended/nested-element-extended/copy-entry",{data:{fieldId:e.data().fieldId,entryId:e.data().id,entryTypeId:s,ownerId:t.settings.ownerId,ownerElementType:t.settings.ownerElementType,siteId:t.settings.ownerSiteId}});this.helper.setEntryReference(i.entryReference),this.checkPaste(a,e,t),this.checkDuplicate(a,t),await d.appendHeadHtml(i.headHtml),await d.appendBodyHtml(i.bodyHtml),this.addStatusMessage(d.t("matrix-extended","Entry reference copied"))}catch{this.addStatusMessage(d.t("matrix-extended","There was an error copying the entry reference"),"error")}a.data("disclosureMenu").hide()},addPasteButton:function(a,n,s,e,t){const i=c(`<li>
            <button class="menu-item" data-action="paste" tabindex="0"> 
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M104.6 48H64C28.7 48 0 76.7 0 112V384c0 35.3 28.7 64 64 64h96V400H64c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H80c0 17.7 14.3 32 32 32h72.4C202 108.4 227.6 96 256 96h62c-7.1-27.6-32.2-48-62-48H215.4C211.6 20.9 188.2 0 160 0s-51.6 20.9-55.4 48zM144 56a16 16 0 1 1 32 0 16 16 0 1 1 -32 0zM448 464H256c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16l140.1 0L464 243.9V448c0 8.8-7.2 16-16 16zM256 512H448c35.3 0 64-28.7 64-64V243.9c0-12.7-5.1-24.9-14.1-33.9l-67.9-67.9c-9-9-21.2-14.1-33.9-14.1H256c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64z"/></svg>
                        </span><span class="menu-item-label">${d.t("matrix-extended","Paste")}</span>
                    </button>
                </li>`);n.append(i),i.find("button").on("click",()=>{this.pasteEntry(a,n,s,e,t)})},checkPaste:function(a,n,s){const e=a.find('button[data-action="paste"]');e.disable();const t=e.parent();if(t.attr("title",""),!this.helper.getEntryReference()||!this.helper.getEntryReference().entryTypeId){t.attr("title",d.t("matrix-extended","There is nothing to paste."));return}if(!s.canCreate()){t.attr("title",d.t("matrix-extended","No more entries can be added."));return}if(!this.helper.isEntryReferenceAllowed(n.data().fieldId)){t.attr("title",d.t("matrix-extended","The copied entry is not allowed here."));return}e.enable()},pasteEntry:async function(a,n,s,e,t){if(t.canCreate()){try{await t.markAsDirty();const{data:i}=await d.sendActionRequest("POST","matrix-extended/nested-element-extended/paste-entry",{data:{fieldId:e.data().fieldId,entryId:e.data().id,entryTypeId:s,ownerId:t.settings.ownerId,ownerElementType:t.settings.ownerElementType,siteId:t.settings.ownerSiteId}});await this.addElementCard(i,t,e.data("id"))}catch{this.addStatusMessage(d.t("matrix-extended","There was an error pasting the entry"),"error")}a.data("disclosureMenu").hide()}},async addElementCard(a,n,s){var p,r,u,h;n.$createBtn&&n.$createBtn.addClass("loading");let e;try{e=await d.sendActionRequest("POST","app/render-elements",{data:{elements:[{type:n.elementType,id:a.id,ownerId:n.settings.ownerId,siteId:a.siteId,instances:[{context:"field",ui:"card",sortable:n.settings.sortable,showActionMenu:!0}]}]}})}catch(o){throw d.cp.displayError((r=(p=o==null?void 0:o.response)==null?void 0:p.data)==null?void 0:r.message),((h=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:h.message)??o}finally{n.$createBtn&&n.$createBtn.removeClass("loading")}n.$elements||n.initCards();const t=c("<li/>"),i=c(e.data.elements[a.id][0]).appendTo(t);return n.$elements.find(`[data-id="${s}"`).parent().after(t),n.initElement(i),await d.appendHeadHtml(e.data.headHtml),await d.appendBodyHtml(e.data.bodyHtml),d.cp.elementThumbLoader.load(i),n.updateCreateBtn(),i},addStatusMessage:function(a,n="notice"){n==="notice"&&d.cp.displayNotice(a),n==="error"&&d.cp.displayError(a)}}))})(window);
//# sourceMappingURL=nestedElementExtendedJs-6d4f2d74.js.map

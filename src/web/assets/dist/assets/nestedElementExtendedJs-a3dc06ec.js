(function(f){const{Craft:s,Garnish:u,$:o}=f;!s||!u||!o||(s.NestedElementExtended=u.Base.extend({settings:{},childParent:{},entryReference:void 0,init:function(e){const t=this;if(this.settings=e.settings||{},this.childParent=e.childParent||{},this.entryReference=e.entryReference||void 0,!u.DisclosureMenu||!s.NestedElementManager)return;const i=s.NestedElementManager.prototype.init;s.NestedElementManager.prototype.init=function(...a){i.apply(this,a),console.log("NestedElementExtended")};const n=u.DisclosureMenu.prototype.show;u.DisclosureMenu.prototype.show=function(...a){t.initDisclosureMenu(this),n.apply(this,a)}},initDisclosureMenu(e){if(!this.settings.experimentalFeatures)return;const{$trigger:t,$container:i}=e;if(!t||!i||!t.hasClass("action-btn"))return;const n=t.closest(".card-actions").parent(".card-actions-container").parent(".card");if(!n.length)return;const{typeId:a,id:r}=n.data();if(!a||!r)return;const d=n.closest(".nested-element-cards").data("nestedElementManager");if(d&&!(d.settings.mode!=="cards"||!d.settings.canCreate)){if(e._hasNestedElementExtensionButtonsInitialized){this.checkDuplicate(i,d);return}e._hasNestedElementExtensionButtonsInitialized=!0,this.addMenu(i,a,n,d)}},addMenu:function(e,t,i,n){const a=o('<ul class="matrix-extended"></ul>'),r=o('<hr class="padded">');this.addDuplicateButton(e,a,t,i,n),this.checkDuplicate(e,n),a.insertBefore(e.find("ul").eq(0)),r.insertAfter(a)},addDuplicateButton:function(e,t,i,n,a){const r=o(`<li>
                <button class="menu-item" data-action="duplicate" tabindex="0">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M64 464H288c8.8 0 16-7.2 16-16V384h48v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h64v48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16zM224 304H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H224c-8.8 0-16 7.2-16 16V288c0 8.8 7.2 16 16 16zm-64-16V64c0-35.3 28.7-64 64-64H448c35.3 0 64 28.7 64 64V288c0 35.3-28.7 64-64 64H224c-35.3 0-64-28.7-64-64z"/></svg>
                    </span><span class="menu-item-label">${s.t("matrix-extended","Duplicate")}</span>
                </button>
            </li>`);t.append(r),r.find("button").on("click",()=>{this.duplicateEntry(e,t,i,n,a)})},duplicateEntry:async function(e,t,i,n,a){if(!a.canCreate())return;const r=await a.getBaseActionData();try{const{data:l}=await s.sendActionRequest("POST","matrix-extended/nested-element-extended/duplicate-entry",{data:{...n.data(),ownerId:r.ownerId,ownerElementType:r.ownerElementType}});await this.addElementCard(l,a,n.data("id"))}catch{this.addStatusMessage(s.t("matrix-extended","There was an error duplicating the entry"),"error")}e.data("disclosureMenu").hide()},checkDuplicate:function(e,t){const i=e.find('button[data-action="duplicate"]');i.disable();const n=i.parent();if(n.attr("title",""),!t.canCreate()){n.attr("title",s.t("matrix-extended","No more entries can be added."));return}i.enable()},async addElementCard(e,t,i){var l,d,p,h;t.$createBtn&&t.$createBtn.addClass("loading");let n;try{n=await s.sendActionRequest("POST","app/render-elements",{data:{elements:[{type:t.elementType,id:e.id,siteId:e.siteId,instances:[{context:"field",ui:"card",sortable:t.settings.sortable,showActionMenu:!0}]}]}})}catch(c){throw s.cp.displayError((d=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:d.message),((h=(p=c==null?void 0:c.response)==null?void 0:p.data)==null?void 0:h.message)??c}finally{t.$createBtn&&t.$createBtn.removeClass("loading")}t.$elements||t.initCards();const a=o("<li/>"),r=o(n.data.elements[e.id][0]).appendTo(a);return t.$elements.find(`[data-id="${i}"`).parent().after(a),t.initElement(r),await s.appendHeadHtml(n.data.headHtml),await s.appendBodyHtml(n.data.bodyHtml),s.cp.elementThumbLoader.load(r),t.updateCreateBtn(),r},addStatusMessage:function(e,t="notice"){t==="notice"&&s.cp.displayNotice(e),t==="error"&&s.cp.displayError(e)}}))})(window);
//# sourceMappingURL=nestedElementExtendedJs-a3dc06ec.js.map
